Index: pay/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from django.shortcuts import render, redirect\nfrom django.views import View\nfrom django.contrib.auth.mixins import LoginRequiredMixin\nfrom django_redis import get_redis_connection\nfrom django.http import JsonResponse, HttpResponse\nfrom datetime import datetime\nfrom django.conf import settings\nfrom django.urls import reverse\nimport logging\nimport traceback\n\n\nfrom alipay.aop.api.AlipayClientConfig import AlipayClientConfig\nfrom alipay.aop.api.DefaultAlipayClient import DefaultAlipayClient\nfrom alipay.aop.api.FileItem import FileItem\nfrom alipay.aop.api.domain.AlipayTradeAppPayModel import AlipayTradeAppPayModel\nfrom alipay.aop.api.domain.AlipayTradePagePayModel import AlipayTradePagePayModel\nfrom alipay.aop.api.domain.AlipayTradePayModel import AlipayTradePayModel\nfrom alipay.aop.api.domain.GoodsDetail import GoodsDetail\nfrom alipay.aop.api.domain.SettleDetailInfo import SettleDetailInfo\nfrom alipay.aop.api.domain.SettleInfo import SettleInfo\nfrom alipay.aop.api.domain.SubMerchant import SubMerchant\nfrom alipay.aop.api.request.AlipayOfflineMaterialImageUploadRequest import AlipayOfflineMaterialImageUploadRequest\nfrom alipay.aop.api.request.AlipayTradeAppPayRequest import AlipayTradeAppPayRequest\nfrom alipay.aop.api.request.AlipayTradePagePayRequest import AlipayTradePagePayRequest\nfrom alipay.aop.api.request.AlipayTradePayRequest import AlipayTradePayRequest\nfrom alipay.aop.api.response.AlipayOfflineMaterialImageUploadResponse import AlipayOfflineMaterialImageUploadResponse\nfrom alipay.aop.api.response.AlipayTradePayResponse import AlipayTradePayResponse\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s %(levelname)s %(message)s',\n    filemode='a',)\nlogger = logging.getLogger('')\n\ndef pay_result(request):\n    return render(request, 'pay/success.html')\n\n\ndef pay_test(request, price):\n    print(request.method)\n    if request.method == 'POST':\n        \"\"\"\n        设置配置，包括支付宝网关地址、app_id、应用私钥、支付宝公钥等，其他配置值可以查看AlipayClientConfig的定义。\n        \"\"\"\n\n        with open('pay/alipay/alipay_keys/app_private.txt', 'r') as f:\n            private_key = f.readlines()[0]\n        with open('pay/alipay/alipay_keys/alipay_public.txt', 'r') as f:\n            ali_public_key = f.readlines()[0]\n        alipay_client_config = AlipayClientConfig()\n        alipay_client_config.server_url = 'https://openapi.alipaydev.com/gateway.do'\n        alipay_client_config.app_id = '2016102100732681'\n        alipay_client_config.app_private_key = private_key\n        alipay_client_config.alipay_public_key = ali_public_key\n\n        \"\"\"\n        得到客户端对象。\n        注意，一个alipay_client_config对象对应一个DefaultAlipayClient，定义DefaultAlipayClient对象后，alipay_client_config不得修改，如果想使用不同的配置，请定义不同的DefaultAlipayClient。\n        logger参数用于打印日志，不传则不打印，建议传递。\n        \"\"\"\n        client = DefaultAlipayClient(alipay_client_config=alipay_client_config, logger=logger)\n\n        \"\"\"\n        #    页面接口示例：alipay.trade.page.pay\n        #    \"\"\"\n        # 对照接口文档，构造请求对象\n        model = AlipayTradePagePayModel()\n        model.out_trade_no = \"pay201905020000221\"\n        model.total_amount = price\n        model.subject = \"测试\"\n        model.body = \"支付宝测试\"\n        model.product_code = \"FAST_INSTANT_TRADE_PAY\"\n        settle_detail_info = SettleDetailInfo()\n        settle_detail_info.amount = price\n        settle_detail_info.trans_in_type = \"userId\"\n        settle_detail_info.trans_in = \"2088102180529084\"\n        settle_detail_infos = list()\n        settle_detail_infos.append(settle_detail_info)\n        settle_info = SettleInfo()\n        settle_info.settle_detail_infos = settle_detail_infos\n        model.settle_info = settle_info\n        # sub_merchant = SubMerchant()\n        # sub_merchant.merchant_id = \"2088102180529084\"\n        # model.sub_merchant = sub_merchant\n        ali_request = AlipayTradePagePayRequest(biz_model=model)\n        ali_request.return_url= '127.0.0.1:8000/pay/pay_result/'\n        # 得到构造的请求，如果http_method是GET，则是一个带完成请求参数的url，如果http_method是POST，则是一段HTML表单片段\n        response = client.page_execute(ali_request, http_method=\"GET\")\n        print(\"alipay.trade.page.pay response:\" + response)\n        return redirect(response)\n\n    else:\n        return render(request, 'pay/index.html')\n\n\n\n\n# /order/alipay\nclass AlipayView(LoginRequiredMixin, View):\n    \"\"\"支付宝支付\"\"\"\n    @staticmethod\n    def sign(logger=None):\n        # 构造签名基础参数\n        alipay_client_config = AlipayClientConfig(sandbox_debug=True)\n        alipay_client_config.app_id = settings.ALIPAY_APPID\n        alipay_client_config.app_private_key = settings.APP_PRIVATE_KEY\n        alipay_client_config.alipay_public_key = settings.ALIPAY_PUBLIC_KEY\n        client = DefaultAlipayClient(alipay_client_config, logger)\n        return client\n\n    @staticmethod\n    def logger():\n        \"\"\"初始化日志\"\"\"\n        logging.basicConfig(\n            level=logging.INFO,\n            format='%(asctime)s %(levelname)s %(message)s',\n            filemode='a', )\n        logger = logging.getLogger('')\n        return logger\n\n    def post(self, request):\n        # 获得支付宝客户端\n        client = AlipayView.sign()\n        # 构造请求参数\n        model = AlipayTradePagePayModel()\n        model.out_trade_no = \"x2\" + str(time.time())\n        model.total_amount = str(1)\n        model.subject = \"天天生鲜订单支付\"\n        model.timeout_express = str(settings.ALIPAY_TIMEOUT_MINUTE) + 'm'\n\n        pay_request = AlipayTradePagePayRequest(biz_model=model)\n        url = 'http://127.0.0.1:8000' + reverse('pay:pay_result')\n        pay_request.notify_url = url  # 支付后回调地址\n        pay_url = client.page_execute(pay_request, http_method='GET')  # 获取支付链接\n        return JsonResponse({'res': 0, 'msg': '正在支付中...', 'url': pay_url})\n\n\n# /order/alipay_result\nclass AlipayResult(View):\n\n    def check_pay(self, params):  # 定义检查支付结果的函数\n        from alipay.aop.api.util.SignatureUtils import verify_with_rsa\n        sign = params.pop('sign', None)  # 取出签名\n        params.pop('sign_type')  # 取出签名类型\n        params = sorted(params.items(), key=lambda e: e[0], reverse=False)  # 取出字典元素按key的字母升序排序形成列表\n        message = \"&\".join(u\"{}={}\".format(k, v) for k, v in params).encode()  # 将列表转为二进制参数字符串\n        # with open(settings.ALIPAY_PUBLIC_KEY_PATH, 'rb') as public_key: # 打开公钥文件\n        try:\n            #     status =verify_with_rsa(public_key.read().decode(),message,sign) # 验证签名并获取结果\n            status = verify_with_rsa(settings.ALIPAY_PUBLIC_KEY.encode('utf-8').decode('utf-8'), message,\n                                     sign)  # 验证签名并获取结果\n            return status  # 返回验证结果\n        except:  # 如果验证失败，返回假值。\n            return False\n\n    def post(self, request):\n        \"\"\"支付宝POST回应\"\"\"\n        params = request.POST.dict()  # type: dict\n        if self.check_pay(params):  # 调用检查支付结果的函数\n            '''\n                此处编写支付失败后的业务逻辑\n            '''\n            return HttpResponse('success')  # 返回成功信息到支付宝服务器\n        else:\n            '''\n                此处编写支付失败后的业务逻辑\n            '''\n            print('支付失败!')\n            return HttpResponse('')\n\n    def get(self, request):\n        \"\"\"支付宝的GET回应\"\"\"\n        params = request.GET.dict()  # 获取参数字典\n        if self.check_pay(params):  # 调用检查支付结果的函数\n            '''\n                此处编写支付成功后的业务逻辑\n            '''\n            return HttpResponse('支付成功！')\n        else:\n            '''\n                此处编写支付失败后的业务逻辑\n            '''\n            return HttpResponse('支付失败！')\n\n\nfrom alipay.aop.api.domain.AlipayTradeQueryModel import AlipayTradeQueryModel\nfrom alipay.aop.api.request.AlipayTradeQueryRequest import AlipayTradeQueryRequest\nfrom alipay.aop.api.response.AlipayTradeQueryResponse import AlipayTradeQueryResponse\nimport time\n\n\n# /order/alipay_check\nclass AlipayCheck(LoginRequiredMixin, View):\n    \"\"\"支付宝结果用户查询\"\"\"\n\n    def post(self, request):\n        \"\"\"查询POST请求\"\"\"\n        while True:\n            # 检测订单状态\n            if order.order_status > 1:\n                print('支付宝内部修改成功!')\n                return JsonResponse({'res': 0, 'msg': '支付成功!'})\n            # 发送查询请求\n            client = AlipayView.sign(AlipayView.logger())\n\n            # 构造请求对象\n            model = AlipayTradeQueryModel()\n            model.out_trade_no = \"x2\" + str(time.time())\n            req = AlipayTradeQueryRequest(biz_model=model)\n\n            # 执行请求操作\n            try:\n                response_content = client.execute(req)\n            except Exception as e:\n                return JsonResponse({'res': -1, 'msg': e})\n            if response_content:\n                # 解析响应结果\n                response = AlipayTradeQueryResponse()\n                response.parse_response_content(response_content)\n                # 响应成功的业务处理\n                if response.is_success():\n                    # 成功\n                    if response.trade_status == 'TRADE_SUCCESS':\n                        return JsonResponse({'res': 0, 'msg': '支付成功!'})\n                    # 等待付款\n                    elif response.trade_status == 'WAIT_BUYER_PAY':\n                        time.sleep(settings.ALIPAY_TIMEOUT_SLEEP_SECS)\n                        continue\n                    else:\n                        return JsonResponse({'res': -1, 'msg': '支付失败'})\n                # 等待创建交易\n                elif response.code == '40004':\n                    # 创建交易超时\n                    if (expire_time > settings.ALIPAY_TIMEOUT_MINUTE * 60):\n                        return JsonResponse({'res': -1, 'msg': '创建交易超时'})\n                    expire_time += settings.ALIPAY_TIMEOUT_SLEEP_SECS\n                    time.sleep(settings.ALIPAY_TIMEOUT_SLEEP_SECS)\n                    continue\n                else:\n                    return JsonResponse({'res': -1, 'msg': '支付失败'})
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pay/views.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ pay/views.py	(date 1590077328250)
@@ -8,8 +8,12 @@
 from django.urls import reverse
 import logging
 import traceback
-
-
+from datetime import datetime
+import os, django
+os.environ.setdefault("DJANGO_SETTINGS_MODULE", "HIS.settings")  # project_name 项目名称
+django.setup()
+from appoint.models import Order, Schedule
+from login.models import User
 from alipay.aop.api.AlipayClientConfig import AlipayClientConfig
 from alipay.aop.api.DefaultAlipayClient import DefaultAlipayClient
 from alipay.aop.api.FileItem import FileItem
@@ -37,9 +41,22 @@
     return render(request, 'pay/success.html')
 
 
-def pay_test(request, price):
+def pay_test(request, price, schedule_id):
     print(request.method)
     if request.method == 'POST':
+        if 'user_id' not in request.COOKIES:
+            return render(request, 'login/home_page_test.html')
+        user_id = request.COOKIES['user_id']
+        patient = User.objects.get(id=user_id)
+        registration = Schedule.objects.get(id=schedule_id)
+        Order.objects.create(
+            patient=patient,
+            registration=registration,
+            status=2,
+            description=request.POST['description'],
+            order_time=datetime.now()
+        )
+        print('Order Created')
         """
         设置配置，包括支付宝网关地址、app_id、应用私钥、支付宝公钥等，其他配置值可以查看AlipayClientConfig的定义。
         """
@@ -66,7 +83,8 @@
         #    """
         # 对照接口文档，构造请求对象
         model = AlipayTradePagePayModel()
-        model.out_trade_no = "pay201905020000221"
+        model.out_trade_no = 'pay'+str(time.time()).replace('.', '')[0:16]
+        # model.out_trade_no = "pay201905020000220"
         model.total_amount = price
         model.subject = "测试"
         model.body = "支付宝测试"
Index: templates/login/user_center_test.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>医患服务系统个人中心</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js\"></script>\n</head>\n{% load static %}\n<style>\n    #function{margin-left:60%;font-size:12px}\n    #title{margin-top: 6px}\n    #All{background-image:url({% static \"blog/images/back2.jpg\" %});width:100%;height:580px}\n    .form-control{width:250px}\n</style>\n\n<body>\n<nav class=\"navbar navbar-default\" role=\"navigation\" style=\"margin:0;padding: 0\">\n    <div class=\"container-fluid\">\n    <div class=\"navbar-header\" id=\"title\">\n        <p class=\"navbar-brand\" style=\"font-size:25px;color: black\">CUFE医院患者服务系统</p>\n    </div>\n    <div id=\"function\">\n        <ul class=\"nav navbar-nav\" style=\"margin-top: 8px;\">\n            <li><a href=\"#\" id=\"page1\">首页</a></li>\n            <li><a href=\"#\" id=\"department\">科室分类</a></li>\n            <li><a href=\"#\" id=\"reserve\">预约挂号</a></li>\n            <li><a href=\"#\" id=\"contact\">联系我们</a></li>\n            <li><a href=\"#\" id=\"help\">帮助中心</a></li>\n            <li><a href=\"#\" id=\"self\">个人中心</a></li>\n            <!--以下部分登陆成功后才会显示-->\n            <li>\n                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\n                    <span class=\"glyphicon glyphicon-user\"></span> <b class=\"caret\"></b></a>\n                <ul class=\"dropdown-menu\" style=\"min-width:100%\">\n                    <li><a href=\"#\">设置</a></li>\n                    <li><a href={% url 'login:user_center' name=user.name %}>我的预约</a></li>\n                    <li><a href={% url 'login:logout' %}>退出登录</a></li>\n                </ul>\n            </li>\n        </ul>\n    </div>\n    </div>\n</nav>\n\n<div class=\"row\" style=\"background-image: url({% static \"blog/images/back2.jpg\" %}\")>\n        <div class=\"col-xs-4\" style=\"margin-left: 6%;height:600px;width:200px;margin-top:5%\">\n            <img src=\"{% static \"blog/images/user.png\" %}\" class=\"img-circle\" style=\"width: 120px;height:120px;margin-top:5%\">\n\n        <div class=\"form-group\" style=\"margin-top: 2%\">\n         <label for=\"firstname\" class=\"col-sm-2 control-label\"><span class=\"glyphicon glyphicon-user\" style=\"color:cornflowerblue;\"></span></label>\n            <p id=\"name\" style=\"font-size: 13px\">{{ user.name }}</p>\n        </div>\n            <div class=\"form-group\" style=\"margin-top: 2%\">\n         <label for=\"firstname\" class=\"col-sm-2 control-label\"><span class=\"glyphicon glyphicon-paperclip\" style=\"color:cornflowerblue;\"></span></label>\n            {% if user.sex == 0 %}\n                <p id=\"sex\" style=\"font-size: 13px\">女</p>\n            {% else %}\n                <p id=\"sex\" style=\"font-size: 13px\">男</p>\n            {% endif %}\n        </div>\n            <div class=\"form-group\" style=\"margin-top: 2%\">\n         <label for=\"firstname\" class=\"col-sm-2 control-label\"><span class=\"glyphicon glyphicon-calendar\" style=\"color:cornflowerblue;\"></span></label>\n            <p id=\"birth\" style=\"font-size: 13px\">{{ user.birth }}</p>\n        </div>\n            <div class=\"form-group\" style=\"margin-top: 2%\">\n            <label for=\"firstname\" class=\"col-sm-2 control-label\"><span class=\"glyphicon glyphicon-phone\" style=\"color:cornflowerblue;\"></span></label>\n            <p id=\"phnoe\" style=\"font-size: 13px\">{{ user.phone }}</p>\n        </div>\n\n            <div class=\"form-group\" style=\"margin-top: 2%\">\n            <label for=\"firstname\" class=\"col-sm-2 control-label\"><span class=\"glyphicon glyphicon-exclamation-sign\" style=\"color:cornflowerblue;\"></span></label>\n                <p id=\"break\" style=\"font-size: 13px\">本月违约次数:<span class=\"label label-danger\" style=\"font-size:10px;margin-left: 5px\">{{ user.break_rule_times }}</span></p>\n        </div>\n\n        </div>\n\n    <div class=\"col-xs-2\" style=\"width:800px\">\n       <div class=\"panel-group\" id=\"accordion\">\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h4 class=\"panel-title\">\n\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#accordion\"\n\t\t\t\t   href=\"#collapseOne\">\n\t\t\t\t\t当前预约\n\t\t\t\t</a>\n\t\t\t</h4>\n\t\t</div>\n\n\t\t<div id=\"collapseOne\" class=\"panel-collapse collapse in\">\n\t\t\t<div class=\"panel-body\">\n                <ul class=\"list-group\">\n                    {% if today_orders|length %}\n                        {% for today_order in today_orders %}\n                            <li class=\"list-group-item\" style=\"margin-top:2%\">\n                                <p>姓名：{{ today_order.registration.doctor.name }}</p>\n                                <p>科室: {{ today_order.registration.department.name }}\n                                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </p>\n                                {% if today_order.registration.type == 1 %}\n                                    <p>号源类型：专家号</p>\n                                {% else %}\n                                    <p>号源类型：普通号</p>\n                                {% endif %}\n                                <p>时间：{{ today_date }} &nbsp&nbsp&nbsp\n                                    {% if today_order.registration.morning_afternoon %}\n                                        2:00-4:00\n                                    {% else %}\n                                        8:00-10:00\n                                    {% endif %}\n                                </p>\n                                {% if today_order.registration.status != 4 %}\n                                    <p>是否违约：无</p>\n                                {% else %}\n                                    <p>是否违约：是</p>\n                                {% endif %}\n                            </li>\n                        {% endfor %}\n\n                    {% else %}\n                        <li class=\"list-group-item\" style=\"margin-top:2%\">\n                            <p>没有记录</p>\n                        </li>\n                    {% endif %}\n                </ul>\n\t\t</div>\n\t</div>\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\" >\n\t\t\t<h4 class=\"panel-title\">\n\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#accordion\"\n\t\t\t\t   href=\"#collapseTwo\">\n\t\t\t\t\t历史预约记录\n\t\t\t\t</a>\n\t\t\t</h4>\n\t\t</div>\n\t\t<div id=\"collapseTwo\" class=\"panel-collapse collapse\">\n\t\t\t<div class=\"panel-body\">\n\t\t\t\t<ul class=\"list-group\">\n                {% if history_orders|length %}\n                        {% for history_order in history_orders %}\n                            <li class=\"list-group-item\" style=\"margin-top:2%\">\n                                <p>姓名：{{ history_order.registration.doctor.name }}</p>\n                                <p>科室: {{ history_order.registration.department.name }}\n                                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </p>\n                                {% if history_order.registration.type == 1 %}\n                                    <p>号源类型：专家号</p>\n                                {% else %}\n                                    <p>号源类型：普通号</p>\n                                {% endif %}\n                                <p>时间：{{ today_date }} &nbsp&nbsp&nbsp\n                                    {% if history_order.registration.morning_afternoon %}\n                                        2:00-4:00\n                                    {% else %}\n                                        8:00-10:00\n                                    {% endif %}\n                                </p>\n                                {% if history_order.registration.status != 4 %}\n                                    <p>是否违约：无</p>\n                                {% else %}\n                                    <p>是否违约：是</p>\n                                {% endif %}\n                            </li>\n                        {% endfor %}\n\n                    {% else %}\n                        <li class=\"list-group-item\" style=\"margin-top:2%\">\n                            <p>没有记录</p>\n                        </li>\n                    {% endif %}\n                </ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class=\"panel panel-default\">\n\t\t<div class=\"panel-heading\">\n\t\t\t<h4 class=\"panel-title\">\n\t\t\t\t<a data-toggle=\"collapse\" data-parent=\"#accordion\"\n\t\t\t\t   href=\"#collapseThree\">\n\t\t\t\t\t违约记录\n\t\t\t\t</a>\n\t\t\t</h4>\n\t\t</div>\n\t\t<div id=\"collapseThree\" class=\"panel-collapse collapse\">\n\t\t\t<div class=\"panel-body\">\n\t\t\t\t<ul class=\"list-group\">\n                   {% if against_rule_orders|length %}\n                        {% for against_rule_order in against_rule_orders %}\n                            <li class=\"list-group-item\" style=\"margin-top:2%\">\n                                <p>姓名：{{ against_rule_order.registration.doctor.name }}</p>\n                                <p>科室: {{ against_rule_order.registration.department.name }}\n                                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </p>\n                                {% if against_rule_order.registration.type == 1 %}\n                                    <p>号源类型：专家号</p>\n                                {% else %}\n                                    <p>号源类型：普通号</p>\n                                {% endif %}\n                                {% if against_rule_order.registration.status != 4 %}\n                                    <p>是否违约：无</p>\n                                {% else %}\n                                    <p>是否违约：是</p>\n                                {% endif %}\n                            </li>\n                        {% endfor %}\n\n                    {% else %}\n                        <li class=\"list-group-item\" style=\"margin-top:2%\">\n                            <p>没有记录</p>\n                        </li>\n                    {% endif %}\n                </ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n       </div>\n       </div>\n</div>\n</div>\n</body>\n</html>\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- templates/login/user_center_test.html	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ templates/login/user_center_test.html	(date 1590076694969)
@@ -37,7 +37,7 @@
                     <span class="glyphicon glyphicon-user"></span> <b class="caret"></b></a>
                 <ul class="dropdown-menu" style="min-width:100%">
                     <li><a href="#">设置</a></li>
-                    <li><a href={% url 'login:user_center' name=user.name %}>我的预约</a></li>
+                    <li><a href={% url 'login:user_center' %}>我的预约</a></li>
                     <li><a href={% url 'login:logout' %}>退出登录</a></li>
                 </ul>
             </li>
Index: templates/appoint/search_test.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Title</title>\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css\"\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\" crossorigin=\"anonymous\">\n    <script src=\"https://code.jquery.com/jquery-3.4.1.slim.min.js\"\n            integrity=\"sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n\"\n            crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js\"\n            integrity=\"sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo\"\n            crossorigin=\"anonymous\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js\"\n            integrity=\"sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6\"\n            crossorigin=\"anonymous\"></script>\n</head>\n<body>\n    <!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>个人预约</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js\"></script>\n</head>\n{% load static %}\n<style>\n    #function{margin-left:60%;font-size:12px}\n    #title{margin-top: 6px}\n    .col-sm-2{color:cornflowerblue}\n    .col-xs-2{padding: 0;maigin:0;width:100px;}\n    .col-xs-1{padding: 0;maigin:0}\n    #all{background-image:url({% static \"appoint/imgs/back2.jpg\" %});width:100%;min-height: 100%}\n\n\n</style>\n\n<body>\n    <nav class=\"navbar navbar-default\" role=\"navigation\" style=\"margin:0;padding: 0\">\n    <div class=\"container-fluid\">\n    <div class=\"navbar-header\" id=\"title\">\n        <p class=\"navbar-brand\" style=\"font-size:25px;color: black\">CUFE医院患者服务系统</p>\n    </div>\n    <div id=\"function\">\n        <ul class=\"nav navbar-nav\" style=\"margin-top: 8px;\">\n            <li><a href=\"#\" id=\"page1\">首页</a></li>\n            <li><a href=\"#\" id=\"department\">科室分类</a></li>\n            <li><a href=\"#\" id=\"reserve\">预约挂号</a></li>\n            <li><a href=\"#\" id=\"contact\">联系我们</a></li>\n            <li><a href=\"#\" id=\"help\">帮助中心</a></li>\n            <li><a href=\"#\" id=\"self\">个人中心</a></li>\n            <!--以下部分登陆成功后才会显示-->\n            <li>\n                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\n                    <span class=\"glyphicon glyphicon-user\"></span> <b class=\"caret\"></b></a>\n                <ul class=\"dropdown-menu\" style=\"min-width:100%\">\n                    <li><a href=\"#\">设置</a></li>\n                    <li><a href=\"#\">我的预约</a></li>\n                    <li><a href={% url 'login:logout' %}>退出登录</a></li>\n                </ul>\n            </li>\n        </ul>\n    </div>\n    </div>\n</nav>\n\n<div class=\"container\" id=\"all\">\n    <div class=\"row\" style=\"margin-left:6%\" >\n        <div class=\"col-xs-1.2\"style=\"margin:0;padding: 0\">\n            <label for=\"lastname\" class=\"col-sm-2 control-label\"><h2><span class=\"label label-info\">预约流程</span></h2></label>\n        </div>\n        <div class=\"col-xs-2\">\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;text-align: center\">\n                <h5><span class=\"glyphicon glyphicon-plus\" ></span>选择科室</h5>\n            </label>\n        </div>\n\n        <div class=\"col-xs-1\" >\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;\">\n        <h5><span class=\"glyphicon glyphicon-chevron-right\"></span></h5>\n            </label>\n        </div>\n        <div class=\"col-xs-2\">\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;text-align: center\">\n                <h5><span class=\"glyphicon glyphicon-plus\" ></span>选择医生</h5>\n            </label>\n        </div>\n\n        <div class=\"col-xs-1\" >\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;\">\n        <h5><span class=\"glyphicon glyphicon-chevron-right\"></span></h5>\n            </label>\n        </div>\n\n        <div class=\"col-xs-2\">\n         <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;text-align: center\">\n             <h5><span class=\"glyphicon glyphicon-calendar\"></span>选择时间</h5></label>\n        </div>\n\n        <div class=\"col-xs-1\" >\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite\">\n        <h5><span class=\"glyphicon glyphicon-chevron-right\"></span></h5>\n            </label>\n        </div>\n\n        <div class=\"col-xs-2\" style=\"width: 160px\">\n         <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:14%;background-color:ghostwhite;text-align: center\">\n             <h5><span class=\"glyphicon glyphicon-list-alt\"></span>生成预约信息</h5></label>\n\n        </div>\n\n        <div class=\"col-xs-1\" >\n            <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite\">\n        <h5><span class=\"glyphicon glyphicon-chevron-right\"></span></h5>\n            </label>\n        </div>\n\n        <div class=\"col-xs-2\">\n         <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"min-width: 100%;margin-top:20%;background-color:ghostwhite;text-align: center\">\n             <h5><span class=\"glyphicon glyphicon-ok\"></span>预约成功</h5></label>\n        </div>\n    </div>\n\n    <form class=\"form-horizontal\" role=\"form\" method=\"post\" action=\"\" style=\"margin-left:25%;margin-top:2%\">\n        <div class=\"form-group\">\n            <div class=\"col-sm-10\" style=\"width: 600px;margin-right:0;padding-right: 0;margin-top:7px\">\n            <input type=\"text\" class=\"form-control\" id=\"condiction\" placeholder=\"输入疾病/科室/医生\">\n            </div>\n            <label for=\"lastname\" style=\"margin-left: 0;padding-left: 0;margin-top:7px\">\n            <button class=\"btn btn-info\"><span class=\"glyphicon glyphicon-search\"></span></button></label>\n        </div>\n    </form>\n\n    <!--所有筛选条件选择后会变成button样式-->\n    <div class=\"container\" style=\"background-color: snow\">\n\n        <div id=\"depart\" style=\"margin-left:8%;width: 1000px\" >\n            <div class=\"form-group\" id=\"title\" >\n        <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"font-size:15px;color: gray;width:105px \">选择科室：</label>\n            </div>\n         <div id=\"choose_depart\" class=\"col-sm-10\" >\n        <ul class=\"list-unstyled list-inline\" style=\"margin-top: 15px;width: 900px;margin-top:0;padding-top:0\">\n            <!--修改科室部分 -->\n            {% for department in departments %}\n                <li><a href=\"/appoint/search_test/picked_department_id={{ department.id }}/\">\n                    <button id=\"Submit6\" class=\"btn btn-sm btn-info\" type=\"button\">{{ department.name }}</button>\n                </a></li>\n            {% endfor %}\n            {% for check_department in check_departments %}\n            <li><a href=\"/appoint/search_test/picked_department_id={{ check_department.id }}/\">\n                <button id=\"Submit6\" class=\"btn btn-sm btn-info\" type=\"button\">{{ check_department.name }}</button></a></li>\n            {% endfor %}\n        </ul>\n            </div>\n     </div>\n\n    </div>\n\n    <div class=\"container\" style=\"background-color: snow\">\n\n        <div id=\"depart\" style=\"margin-left:8%;width: 1000px\" >\n            <div class=\"form-group\" id=\"title\" >\n        <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"font-size:15px;color: gray;width:105px \">选择日期：</label>\n            </div>\n         <div id=\"choose_depart\" class=\"col-sm-10\" >\n        <ul class=\"list-unstyled list-inline\" style=\"margin-top: 15px;width: 900px;margin-top:0;padding-top:0\">\n            <!--修改日期部分 -->\n            {% for date in dates %}\n                <li><a href='/appoint/search_test/picked_date={{ date.id }}'> <button  class=\"btn btn-sm btn-info\" type=\"button\">{{ date.text }}</button></a></li>\n            {% endfor %}\n        </ul>\n            </div>\n     </div>\n\n    </div>\n\n    <div class=\"container\" style=\"background-color: snow\">\n\n        <div id=\"depart\" style=\"margin-left:8%;width: 1000px\" >\n            <div class=\"form-group\" id=\"title\" >\n        <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"font-size:15px;color: gray;width:105px \">挂号类型：</label>\n            </div>\n         <div id=\"choose_depart\" class=\"col-sm-10\" >\n        <ul class=\"list-unstyled list-inline\" style=\"margin-top: 15px;width: 900px;margin-top:0;padding-top:0\">\n            <!--修改号种类部分 -->\n            {% for type in types %}\n            <li><a href=\"/appoint/search_test/picked_type={{ type.id }}\"> <button  class=\"btn btn-sm btn-info\" type=\"button\">{{ type.name }}</button></a></li>\n            {% endfor %}\n        </ul>\n\n            </div>\n     </div>\n\n    </div>\n\n    <div class=\"container\" style=\"background-color: snow\">\n\n        <div id=\"depart\" style=\"margin-left:8%;width: 1000px\" >\n            <div class=\"form-group\" id=\"title\" >\n        <label for=\"lastname\" class=\"col-sm-2 control-label\" style=\"font-size:15px;color: gray;width:105px \">挂号类型：</label>\n            </div>\n         <div id=\"choose_depart\" class=\"col-sm-10\" >\n        <ul class=\"list-unstyled list-inline\" style=\"margin-top: 15px;width: 900px;margin-top:0;padding-top:0\">\n            <!--上下午部分 -->\n            {% for morning_afternoon in morning_afternoons %}\n            <li><a href=\"/appoint/search_test/picked_morning_afternoon={{ morning_afternoon.id }}\"> <button  class=\"btn btn-sm btn-info\" type=\"button\">{{ morning_afternoon.name }}</button></a></li>\n            {% endfor %}\n        </ul>\n\n            </div>\n     </div>\n\n    </div>\n\n    <div class=\"container\" style=\"background-color: snow\">\n        <div class=\"row\" style=\"margin-left:12%;margin-top:0\" >\n{#            <div class=\"col-xs-2\"style=\"width:33%;margin-top:2%;border-style: dotted;border-color:silver\">#}\n{#                <div class=\"row\" style=\"margin-left:5%;margin-top:3%\" >#}\n{#                    <div class=\"col-xs-2\"style=\"width:130px\">#}\n{#                        <!--修改医生信息部分 -->#}\n{#                        <p>姓名：夏静涵</p>#}\n{#                        <p>性别：女</p>#}\n{#                        <p>科室：儿科</p>#}\n{#                        <p>职称：主任医师</p>#}\n{#                        <p>号源：专家号</p>#}\n{#                        <div class=\"form-group\">#}\n{#                           <label for=\"lastname\"><button class=\"btn btn-info\" href=\"#\">我要预约</button></label>#}\n{#                        </div>#}\n{#                    </div>#}\n{##}\n{#                    <div class=\"col-xs-2\"style=\"\">#}\n{#                        <img src=\"{% static \"appoint/imgs/woman.jpg\" %}\" class=\"img-rounded\" style=\"width: 160px;height: 200px\">#}\n{#                    </div>#}\n{#                </div>#}\n{#            </div>#}\n            {% if picked_type %}\n                {% if doctors|length %}\n                    {% for doctor in page_doctors %}\n                        <div class=\"col-xs-2\" style=\"width:30%;margin-top:5%\">\n                            <div class=\"row\" style=\"margin-left:10%\">\n                                <div class=\"col-xs-2\" style=\"width:130px\">\n                                    <p>姓名：{{ doctor.name }}</p>\n                                    <p>性别：{{ doctor.sex }}</p>\n                                    <p>科室：{{ doctor.department_name }}</p>\n                                    <p>职称：{{ doctor.title }}</p>\n                                    <p>号源：专家号</p>\n                                    <div class=\"form-group\">\n                                        <label for=\"lastname\">\n                                            <a href=\"/appoint/registration_test/picked_department_id={{ doctor.department_id }}/picked_doctor_id={{ doctor.id }}/picked_date={{ picked_date }}/picked_type={{ picked_type }}/picked_morning_afternoon={{ picked_morning_afternoon }}\">\n                                                <button class=\"btn btn-info\">我要预约</button>\n                                            </a>\n                                        </label>\n                                    </div>\n                                </div>\n\n                                <div class=\"col-xs-2\" style=\"\">\n                                    {% if doctor.sex == '男' %}\n                                        <img src=\"{% static 'appoint/imgs/man.jpg' %}\" class=\"img-rounded\"\n                                             style=\"width: 160px;height: 200px\">\n                                    {% else %}\n                                        <img src=\"{% static 'appoint/imgs/woman.jpg' %}\" class=\"img-rounded\"\n                                             style=\"width: 160px;height: 200px\">\n                                    {% endif %}\n                                </div>\n                            </div>\n                        </div>\n                    {% endfor %}\n                {% else %}\n                    <h1>无结果</h1>\n                {% endif %}\n            {% else %}\n                {% if schedules|length %}\n                    {% for schedule in page_schedules %}\n                     <div class=\"col-xs-2\"style=\"width:30%;margin-top:5%\">\n                     <div class=\"row\" style=\"margin-left:10%\" >\n                        <div class=\"col-xs-2\"style=\"width:130px\">\n                            <p>科室：{{schedule.department_name}}</p>\n                            <p>号源：普通号</p>\n                            <div class=\"form-group\">\n                               <label for=\"lastname\">\n                                   <a href=\"/appoint/registration_test/picked_department_id={{ schedule.department_id }}/picked_date={{ picked_date }}/picked_type={{ picked_type }}/picked_morning_afternoon={{ picked_morning_afternoon }}\">\n                                   <button class=\"btn btn-info\">\n                                       我要预约\n                                   </button>\n                                       </a>\n                                </label>\n                            </div>\n                        </div>\n                     </div>\n                    </div>\n                    {% endfor %}\n                {% else %}\n                    <h1>无结果</h1>\n                {% endif %}\n            </div>\n        {% endif %}\n{#            <div class=\"col-xs-2\"style=\"width:30%;margin-top:5%\">#}\n{#                <div class=\"row\" style=\"margin-left:10%\" >#}\n{#                    <div class=\"col-xs-2\"style=\"width:130px\">#}\n{#                        <p>姓名：杜苓</p>#}\n{#                        <p>性别：男</p>#}\n{#                        <p>科室：妇产科</p>#}\n{#                        <p>职称：副主任医师</p>#}\n{#                        <p>号源：专家号</p>#}\n{#                        <div class=\"form-group\">#}\n{#                           <label for=\"lastname\"><button class=\"btn btn-info\" href=\"#\">我要预约</button></label>#}\n{#                        </div>#}\n{#                    </div>#}\n{##}\n{#                    <div class=\"col-xs-2\"style=\"\">#}\n{#                        <img src=\"{% static \"appoint/imgs/man.jpg\" %}\" class=\"img-rounded\" style=\"width: 160px;height: 200px\">#}\n{#                    </div>#}\n{#                </div>#}\n{#            </div>#}\n\n\n        </div>\n\n\n\n        <!--分页器部分 -->\n    <ul class=\"pagination\" style=\"margin-left: 40%\">\n        <li><a href=\"/appoint/search_test/change_page=previous/\">&laquo;</a></li>\n        {% for page in pages %}\n            {% if picked_page == page %}\n                <li class=\"active\"><a href=\"/appoint/search_test/picked_page={{ page }}/\">{{ page }}</a></li>\n            {% else %}\n                <li><a href=\"/appoint/search_test/picked_page={{ page }}/\">{{ page }}</a></li>\n\n            {% endif %}\n        {% endfor %}\n        <li><a href=\"/appoint/search_test/change_page=next/\">&raquo;</a></li>\n    </ul>\n    </div>\n\n</div>\n</body>\n</html>\n\n</body>\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- templates/appoint/search_test.html	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ templates/appoint/search_test.html	(date 1590074416511)
@@ -218,25 +218,6 @@
 
     <div class="container" style="background-color: snow">
         <div class="row" style="margin-left:12%;margin-top:0" >
-{#            <div class="col-xs-2"style="width:33%;margin-top:2%;border-style: dotted;border-color:silver">#}
-{#                <div class="row" style="margin-left:5%;margin-top:3%" >#}
-{#                    <div class="col-xs-2"style="width:130px">#}
-{#                        <!--修改医生信息部分 -->#}
-{#                        <p>姓名：夏静涵</p>#}
-{#                        <p>性别：女</p>#}
-{#                        <p>科室：儿科</p>#}
-{#                        <p>职称：主任医师</p>#}
-{#                        <p>号源：专家号</p>#}
-{#                        <div class="form-group">#}
-{#                           <label for="lastname"><button class="btn btn-info" href="#">我要预约</button></label>#}
-{#                        </div>#}
-{#                    </div>#}
-{##}
-{#                    <div class="col-xs-2"style="">#}
-{#                        <img src="{% static "appoint/imgs/woman.jpg" %}" class="img-rounded" style="width: 160px;height: 200px">#}
-{#                    </div>#}
-{#                </div>#}
-{#            </div>#}
             {% if picked_type %}
                 {% if doctors|length %}
                     {% for doctor in page_doctors %}
Index: appoint/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from math import ceil\n\nfrom django.shortcuts import render, redirect\nfrom .models import Department, Doctor, Schedule\nfrom business_calendar import Calendar, MO, TU, WE, TH, FR\nfrom datetime import datetime, timedelta\nfrom django.views import View\nfrom .forms import DatePickForm\nfrom .data import appoint_basic_data\n\n\n# Create your views here.\ndef register_test(request, department, doctor_id, weekday, type):\n    if len(str(department)) != 0:\n        department = Department.objects.get(name=department)\n        doctors = Doctor.objects.get(department=department)\n\n\ndef deal_date(request, picked_date):\n    print(picked_date)\n    return render(request, template_name='pay/index.html')\n\n\ndef deal_registration(request, *args, **kwargs):\n    if request.method != 'POST':\n        print(kwargs)\n        for key in kwargs.keys():\n            kwargs[key] = int(kwargs[key])\n        context = {}\n        department = Department.objects.get(id=kwargs['picked_department_id'])\n        if kwargs['picked_type']:\n            doctor = Doctor.objects.get(id=kwargs['picked_doctor_id'])\n            doctor = doctor\n            schedule = Schedule.objects.get(department=department,\n                                                       doctor=doctor,\n                                                       morning_afternoon=kwargs['picked_morning_afternoon'],\n                                                       type=kwargs['picked_type'],\n                                                       weekday=kwargs['picked_date'],\n                                                       )\n            context['doctor_name'] = doctor.name\n            context['doctor_sex'] = '男' if doctor.sex else '女'\n            context['doctor_title'] = doctor.title\n            context['doctor_strength'] = doctor.strength\n        else:\n            schedule = Schedule.objects.get(department=department,\n                                            morning_afternoon=kwargs['picked_morning_afternoon'],\n                                            type=kwargs['picked_type'],\n                                            weekday=kwargs['picked_date'],\n                                                       )\n        context['department_name'] = department.name\n        context['type'] = kwargs['picked_type']\n        context['price'] = schedule.price\n        context['date'] = str(datetime.today().date()+timedelta(days=kwargs['picked_date']))\n        context['time'] = '上午8:00 --  10:00' if not kwargs['picked_morning_afternoon'] else '下午2:00 -- 4:00'\n        context['schedule_id'] = schedule.id\n        return render(request, template_name='appoint/submit_test.html', context=context)\n    else:\n        print(request.POST.get('description'))\n        user_id = request.COOKIES.get('user_id')\n        print(user_id)\n        context = {}\n        return render(request, template_name='appoint/submit_test.html', context=context)\n\n\nclass AppointView(View):\n    initial = appoint_basic_data\n    form = DatePickForm()\n    picked_data = {}\n\n    def dispatch(self, request, *args, **kwargs):\n        # self.initial['dates'] = [datetime.today().date() + timedelta(days=i) for i in range(7)]\n        # self.initial['dates'] = [str(date) + weekdays[datetime.isoweekday(date)] for date in self.initial['dates']]\n        print('dispatch')\n        if request.method == 'POST':\n            return self.post(request)\n        else:\n            for key in kwargs.keys():\n                if key in ['picked_type','picked_page','picked_date','picked_morning_afternoon','picked_department_id']:\n                    self.initial[key] = int(kwargs[key])\n                else:\n                    self.initial[key] = kwargs[key]\n\n                if key in ['picked_type', 'picked_morning_afternoon', 'picked_date']:\n                    self.initial['schedule_objs'] = Schedule.objects.filter(type=self.initial['picked_type'],\n                                                                            morning_afternoon=self.initial['picked_morning_afternoon'],\n                                                                            weekday=self.initial['picked_date'])\n                    if 'picked_department_id' in self.initial.keys():\n                        self.initial['schedule_objs'] = self.initial['schedule_objs'].filter(department=Department.objects.get(id=int(self.initial['picked_department_id'])))\n\n                if key == 'picked_department_id':\n                    self.initial['schedule_objs'] = Schedule.objects.filter(type=self.initial['picked_type'],\n                                                                            morning_afternoon=self.initial['picked_morning_afternoon'],\n                                                                            weekday=self.initial['picked_date'], department=Department.objects.get(id=self.initial['picked_department_id']))\n            print(self.initial['picked_type']==0)\n            if self.initial['picked_type']:\n                self.initial['doctor_objs'] = [schedule.doctor for schedule in self.initial['schedule_objs']]\n                self.initial['pages'] = list(range(1, max(2, ceil(len(self.initial['doctor_objs'])/8+1))))\n                self.initial['doctors'] = [{'id': doctor.id, 'name': doctor.name, 'sex': '男' if doctor.sex == 1 else '女',\n                         'department_name': doctor.department.name, 'department_id': doctor.department.id, 'title': doctor.title} for doctor in\n                        self.initial['doctor_objs']]\n            else:\n                self.initial['pages'] = list(range(1, max(2, ceil(len(self.initial['schedule_objs'])/8+1))))\n\n            self.initial['schedules'] = [{'department_name': schedule.department.name, 'id': schedule.id, 'department_id': schedule.department.id} for schedule in\n                              self.initial['schedule_objs']]\n\n            if 'picked_page' not in kwargs.keys() and 'change_page' not in kwargs.keys():\n                self.initial['picked_page'] = 1\n            elif 'picked_page' in kwargs.keys():\n                self.initial['picked_page'] = int(kwargs['picked_page'])\n            elif kwargs['change_page']  == 'previous':\n                self.initial['picked_page'] = self.initial['picked_page'] - 1 if  self.initial['picked_page'] != 1 else 1\n            else:\n                self.initial['picked_page'] = self.initial['picked_page'] + 1 if  self.initial['picked_page'] != self.initial['pages'][-1] else self.initial['pages'][-1]\n\n            if self.initial['picked_page'] != self.initial['pages'][-1]:\n                self.initial['page_schedules'] = self.initial['schedules'][(self.initial['picked_page']-1)*8: self.initial['picked_page']*8]\n                self.initial['page_doctors'] = self.initial['doctors'][(self.initial['picked_page']-1)*8: self.initial['picked_page']*8]\n            else:\n                self.initial['page_schedules'] = self.initial['schedules'][\n                    (self.initial['picked_page'] - 1) * 8:]\n                self.initial['page_doctors'] = self.initial['doctors'][\n                    (self.initial['picked_page'] - 1) * 8:]\n\n            for key in self.initial.keys():\n                if 'picked' in key:\n                    print(key, self.initial[key])\n            return render(request, template_name='appoint/search_test.html', context=self.initial)\n\n\n\n\n    # def dispatch(self, request, *args, **kwargs):\n    #     if request.method == 'POST':\n    #         return self.post(request)\n    #     else:\n    #         return render(request, template_name='appoint/register_all_test.html', context={'days': self.form})\n    #\n    # def post(self, request, *args, **kwargs):\n    #     self.initial = request.POST\n    #     if 'dates' in self.initial.keys():\n    #         today = datetime.today()\n    #         picked_day = today + timedelta(days=int(self.initial['dates'][-1]))\n    #         self.picked_data['date'] = picked_day\n    #\n    #     else:\n    #         return render(request, template_name='appoint/register_all_test.html')\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- appoint/views.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ appoint/views.py	(date 1590078374747)
@@ -1,13 +1,16 @@
 from math import ceil
 
 from django.shortcuts import render, redirect
-from .models import Department, Doctor, Schedule
+from .models import Department, Doctor, Schedule, Order
 from business_calendar import Calendar, MO, TU, WE, TH, FR
 from datetime import datetime, timedelta
 from django.views import View
 from .forms import DatePickForm
 from .data import appoint_basic_data
-
+import os, django
+os.environ.setdefault("DJANGO_SETTINGS_MODULE", "HIS.settings")  # project_name 项目名称
+django.setup()
+from login.models import User
 
 # Create your views here.
 def register_test(request, department, doctor_id, weekday, type):
@@ -53,13 +56,15 @@
         context['date'] = str(datetime.today().date()+timedelta(days=kwargs['picked_date']))
         context['time'] = '上午8:00 --  10:00' if not kwargs['picked_morning_afternoon'] else '下午2:00 -- 4:00'
         context['schedule_id'] = schedule.id
-        return render(request, template_name='appoint/submit_test.html', context=context)
+        response = render(request, template_name='appoint/submit_test.html', context=context)
+        response.set_cookie(key='user_id', value=request.COOKIES['user_id'], expires=3600)
+        return response
     else:
         print(request.POST.get('description'))
         user_id = request.COOKIES.get('user_id')
-        print(user_id)
-        context = {}
-        return render(request, template_name='appoint/submit_test.html', context=context)
+        response = render(request, template_name='appoint/submit_test.html',)
+        response.set_cookie(key='user_id', value=user_id, expires=3600)
+        return response
 
 
 class AppointView(View):
@@ -92,6 +97,11 @@
                                                                             morning_afternoon=self.initial['picked_morning_afternoon'],
                                                                             weekday=self.initial['picked_date'], department=Department.objects.get(id=self.initial['picked_department_id']))
             print(self.initial['picked_type']==0)
+            user_orders = Order.objects.filter(patient=User.objects.get(id=request.COOKIES['user_id']))
+            if user_orders:
+                for user_order in user_orders:
+                    print(user_order.id)
+                    self.initial['schedule_objs'] = self.initial['schedule_objs'].exclude(id=user_order.id)
             if self.initial['picked_type']:
                 self.initial['doctor_objs'] = [schedule.doctor for schedule in self.initial['schedule_objs']]
                 self.initial['pages'] = list(range(1, max(2, ceil(len(self.initial['doctor_objs'])/8+1))))
@@ -125,7 +135,9 @@
             for key in self.initial.keys():
                 if 'picked' in key:
                     print(key, self.initial[key])
-            return render(request, template_name='appoint/search_test.html', context=self.initial)
+            response = render(request, template_name='appoint/search_test.html', context=self.initial)
+            response.set_cookie(key='user_id', value=request.COOKIES['user_id'], expires=3600)
+            return response
 
 
 
Index: login/urls.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from django.contrib import admin\nfrom django.urls import path, re_path\nfrom . import views\nfrom .views import SignUpView, SignInView, logout\n\napp_name='login'\nurlpatterns= [\n    # path('sign_up_test/', views.sign_up_test, name='sign_up_test'),\n    path('sign_up_test/', SignUpView.as_view(), name='sign_up_test'),\n    re_path(r'^sign_up_test/welcome=(?P<name>.+)/$', views.welcome_sign_up, name='welcome_user_test'),\n    path('sign_in_test/', SignInView.as_view(), name='sign_in_test'),\n    re_path(r'^sign_in_test/user=(?P<name>.+)/$', views.welcome_login, name='welcome_login'),\n    path('logout/', views.logout, name='logout'),\n    path('user_center/<str:name>/', views.user_center, name='user_center')\n]\n\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- login/urls.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ login/urls.py	(date 1590076694963)
@@ -11,6 +11,6 @@
     path('sign_in_test/', SignInView.as_view(), name='sign_in_test'),
     re_path(r'^sign_in_test/user=(?P<name>.+)/$', views.welcome_login, name='welcome_login'),
     path('logout/', views.logout, name='logout'),
-    path('user_center/<str:name>/', views.user_center, name='user_center')
+    path('user_center/', views.user_center, name='user_center')
 ]
 
Index: templates/appoint/submit_test.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>我要预约</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js\"></script>\n</head>\n{% load static %}\n<style>\n    #function{margin-left:60%;font-size:12px}\n    #title{margin-top: 6px}\n    #All{background-image:url({% static \"blog/images/back2.jpg\" %});width:100%;height:700px}\n    .form-control{width:250px}\n</style>\n\n<body>\n<nav class=\"navbar navbar-default\" role=\"navigation\" style=\"margin:0;padding: 0\">\n    <div class=\"container-fluid\">\n    <div class=\"navbar-header\" id=\"title\">\n        <p class=\"navbar-brand\" style=\"font-size:25px;color: black\">CUFE医院患者服务系统</p>\n    </div>\n    <div id=\"function\">\n        <ul class=\"nav navbar-nav\" style=\"margin-top: 8px;\">\n            <li><a href=\"#\" id=\"page1\">首页</a></li>\n            <li><a href=\"#\" id=\"department\">科室分类</a></li>\n            <li><a href=\"#\" id=\"reserve\">预约挂号</a></li>\n            <li><a href=\"#\" id=\"contact\">联系我们</a></li>\n            <li><a href=\"#\" id=\"help\">帮助中心</a></li>\n            <li><a href=\"#\" id=\"self\">个人中心</a></li>\n            <!--以下部分登陆成功后才会显示-->\n            <li>\n                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\n                    <span class=\"glyphicon glyphicon-user\"></span> <b class=\"caret\"></b></a>\n                <ul class=\"dropdown-menu\" style=\"min-width:100%\">\n                    <li><a href=\"#\">设置</a></li>\n                    <li><a href=\"#\">我的预约</a></li>\n                    <li><a href=\"#\">退出登录</a></li>\n                </ul>\n            </li>\n        </ul>\n    </div>\n    </div>\n</nav>\n    {% if type %}\n    <div class=\"container\" id=\"All\" >\n        <div class=\"row\">\n            <div class=\"col-xs-6\" style=\"width:550px;margin-left: 6%;margin-top:10%\">\n                <div class=\"row\">\n                    <div class=\"col-xs-2\">\n                        <img src=\"{% static \"blog/images/woman.jpg\" %}\" class=\"img-rounded\" style=\"width: 180px;height: 230px\">\n                    </div>\n\n                    <div class=\"col-xs-2\" style=\"margin-left: 20%;width: 280px\">\n                        <p>姓名：{{ doctor_name }}</p>\n                        <p>性别：{{ doctor_sex }}</p>\n                        <p>科室：{{ department_name }}</p>\n                        <p>职称：{{ doctor_title }}</p>\n                        <p>号源类型：专家号 <span class=\"label label-warning\" style=\"font-size:15px;margin-left: 5px\">￥80</span></p>\n                        {% if doctor_strength|length %}\n                            <p>擅长领域：{{ doctor_strength }}</p>\n                        {% endif %}\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"col-xs-6\">\n        <form class=\"form-horizontal\" role=\"form\" method=\"post\" action={% url 'pay:pay_test' arg1=price%}\n              style=\"margin-top:6%;opacity:0.6;width:700px\">\n            {% csrf_token %}\n            <div class=\"form-group\" style=\"margin-left:30%;min-width:100%\">\n        <label for=\"firstname\" class=\"col-sm-2 control-label\" style=\"font-size: 20px;width: 250px\">CUFE医院挂号预约申请</label>\n            </div>\n\n            <fieldset disabled>\n         <div class=\"form-group\" style=\"margin-left: 16%\">\n             <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\" >预约医生：</label>\n             <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ doctor_name }}></div>\n         </div>\n\n             <div class=\"form-group\" style=\"margin-left: 16%\">\n             <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">预约科室：</label>\n             <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ department_name }}></div>\n         </div>\n\n                <div class=\"form-group\" style=\"margin-left: 16%\">\n             <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">医生职称：</label>\n             <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ doctor_title }}></div>\n         </div>\n\n                <div class=\"form-group\" style=\"margin-left: 16%\">\n                    <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">号源类型：</label>\n\n                        <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\"\n                                                      placeholder=\"专家号\"></div>\n                </div>\n\n                <div class=\"form-group\" style=\"margin-left: 16%\">\n             <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">挂号价格：</label>\n             <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ price }}></div>\n         </div>\n\n            <div class=\"form-group\" style=\"margin-left: 16%\">\n              <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">预约日期：</label>\n             <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ date }}></div>\n         </div>\n            </fieldset>\n\n\n                    <div class=\"form-group\" style=\"margin-left: 16%\">\n                        <label for=\"firstname\" class=\"col-sm-2 control-label\">预约时间：</label>\n                        <div class=\"col-sm-10\">\n                            <label style=\"padding-top:5px\">\n                                <input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ time }}>\n                            </label>\n                        </div>\n                    </div>\n\n            <div class=\"form-group\" style=\"margin-left: 16%\">\n             <label for=\"病症描述\" class=\"col-sm-2 control-label\">病症描述：</label>\n                <div class=\"col-sm-10\">\n            <textarea class=\"form-control\" id=\"病症描述\" name=\"description\" rows=\"3\" placeholder=\"病症描述\"></textarea>\n                </div>\n         </div>\n\n        <div class=\"form-group\" style=\"margin-left: 2%;padding-bottom: 5%\">\n    <div class=\"col-sm-offset-2 col-sm-10\">\n      <label for=\"firstname\" class=\"col-sm-2 control-label\">\n          <button type=\"button\" class=\"btn btn-info\" style=\"text-align: center;width:100px\">提交申请</button>\n      </label>\n        <label for=\"firstname\" class=\"col-sm-2 control-label\" style=\"margin-left: 20%\">\n          <button type=\"button\" class=\"btn btn-info\" style=\"text-align: center;width:100px\">返回</button>\n      </label>\n    </div>\n        </div>\n\n        </form>\n            </div>\n        </div>\n\n    </div>\n\n    {% else %}\n        <div class=\"col-xs-6\">\n        <form class=\"form-horizontal\" role=\"form\" method=\"post\" action={% url 'pay:pay_test' arg1=price%}\n              style=\"margin-top:6%;opacity:0.6;width:700px\">\n            {% csrf_token %}\n        <div class=\"form-group\" style=\"margin-left:30%;min-width:100%\">\n            <label for=\"firstname\" class=\"col-sm-2 control-label\"\n                   style=\"font-size: 20px;width: 250px\">CUFE医院挂号预约申请</label>\n        </div>\n\n        <fieldset disabled>\n        <div class=\"form-group\" style=\"margin-left: 16%\">\n            <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">预约科室：</label>\n            <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\"\n                                          placeholder={{ department_name }}></div>\n        </div>\n\n        <div class=\"form-group\" style=\"margin-left: 16%\">\n        <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">号源类型：</label>\n\n        <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\"\n                                      placeholder=\"普通号\"></div>\n\n</div>\n\n<div class=\"form-group\" style=\"margin-left: 16%\">\n    <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">挂号价格：</label>\n    <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ price }}></div>\n</div>\n\n<div class=\"form-group\" style=\"margin-left: 16%\">\n    <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">预约日期：</label>\n    <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ date }}></div>\n</div>\n<div class=\"form-group\" style=\"margin-left: 16%\">\n    <label for=\"disabledTextInput\" class=\"col-sm-2 control-label\">预约日期：</label>\n    <div class=\"col-sm-10\"><input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ date }}></div>\n</div>\n</fieldset>\n\n\n<div class=\"form-group\" style=\"margin-left: 16%\">\n    <label for=\"firstname\" class=\"col-sm-2 control-label\">预约时间：</label>\n    <div class=\"col-sm-10\">\n        <label style=\"padding-top:5px\">\n            <input type=\"text\" id=\"disabledTextInput\" class=\"form-control\" placeholder={{ time }}>\n        </label>\n    </div>\n</div>\n\n<div class=\"form-group\" style=\"margin-left: 16%\">\n    <label for=\"form-controlt\" class=\"col-sm-2 control-label\">病症描述：</label>\n    <div class=\"col-sm-10\">\n        <label>\n            <textarea class=\"form-controlt\" name=\"description\" rows=\"3\" placeholder=\"病症描述\"></textarea>\n        </label>\n    </div>\n</div>\n\n<div class=\"form-group\" style=\"margin-left: 2%;padding-bottom: 5%\">\n    <div class=\"col-sm-offset-2 col-sm-10\">\n        <label for=\"firstname\" class=\"col-sm-2 control-label\">\n            <button type=\"submit\" class=\"btn btn-info\" style=\"text-align: center;width:100px\">提交申请</button>\n        </label>\n        <label for=\"firstname\" class=\"col-sm-2 control-label\" style=\"margin-left: 20%\">\n            <button type=\"button\" class=\"btn btn-info\" style=\"text-align: center;width:100px\">返回</button>\n        </label>\n    </div>\n</div>\n\n</form>\n</div>\n    {% endif %}\n\n</body>\n</html>\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- templates/appoint/submit_test.html	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ templates/appoint/submit_test.html	(date 1590075452994)
@@ -68,7 +68,7 @@
             </div>
 
             <div class="col-xs-6">
-        <form class="form-horizontal" role="form" method="post" action={% url 'pay:pay_test' arg1=price%}
+        <form class="form-horizontal" role="form" method="post" action={% url 'pay:pay_test' price=price schedule_id=schedule_id %}
               style="margin-top:6%;opacity:0.6;width:700px">
             {% csrf_token %}
             <div class="form-group" style="margin-left:30%;min-width:100%">
@@ -129,10 +129,10 @@
         <div class="form-group" style="margin-left: 2%;padding-bottom: 5%">
     <div class="col-sm-offset-2 col-sm-10">
       <label for="firstname" class="col-sm-2 control-label">
-          <button type="button" class="btn btn-info" style="text-align: center;width:100px">提交申请</button>
+          <button type="submit" class="btn btn-info" style="text-align: center;width:100px">提交申请</button>
       </label>
         <label for="firstname" class="col-sm-2 control-label" style="margin-left: 20%">
-          <button type="button" class="btn btn-info" style="text-align: center;width:100px">返回</button>
+          <button type="submit" class="btn btn-info" style="text-align: center;width:100px">返回</button>
       </label>
     </div>
         </div>
@@ -208,7 +208,7 @@
             <button type="submit" class="btn btn-info" style="text-align: center;width:100px">提交申请</button>
         </label>
         <label for="firstname" class="col-sm-2 control-label" style="margin-left: 20%">
-            <button type="button" class="btn btn-info" style="text-align: center;width:100px">返回</button>
+            <button type="submit" class="btn btn-info" style="text-align: center;width:100px">返回</button>
         </label>
     </div>
 </div>
Index: login/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from django.core.exceptions import ObjectDoesNotExist\nfrom django.http import HttpResponseRedirect, HttpResponse\nfrom django.shortcuts import redirect\nfrom django.http.cookie import SimpleCookie\nimport os, django\nos.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"HIS.settings\")  # project_name 项目名称\ndjango.setup()\nfrom django.shortcuts import render\nfrom django.views import View\nfrom django.contrib.auth.hashers import make_password, check_password\nfrom .forms import SignUp, SignIn\nfrom .models import User\nfrom datetime import date\nfrom datetime import datetime\nfrom appoint.models import Order\n# Create your views here.\n\n\ndef user_center(request, name):\n    context = get_user_center_context(name)\n    return render(request, template_name='login/user_center_test.html', context=context)\n\n\ndef logout(request):\n    response = render(request, 'login/home_page_test.html', context={'sign_in_form': SignIn()})\n    response.set_cookie(key='post_token', value='allow')\n    response.delete_cookie('user_id')\n    return response\n\n\ndef sign_up_test(request):\n    sign_up_form = SignUp()\n    context = {\n        \"sign_up_form\": sign_up_form\n    }\n    return render(request, 'login/sign_up_test.html', context=context)\n\n\ndef welcome_sign_up(request, name):\n    return render(request, 'login/welcome_user_test.html', context={'user_name': name})\n\n\ndef welcome_login(request, name):\n    return render(request, 'login/welcome_login_test.html', context={'name': name})\n\n\nclass SignInView(View):\n    form_class = SignIn\n    initial = {'key': 'value'}\n    template_name='login/home_page_test.html'\n    success_template_name = 'login/user_center_test.html'\n\n    def dispatch(self, request, *args, **kwargs):\n        if request.method == 'POST':\n            return self.post(request)\n        else:\n            if request.COOKIES['post_token'] != 'allow':\n                return redirect('appoint:search_test')\n            response = render(request, self.template_name, context={'sign_in_form': SignIn()})\n            response.set_cookie(key='post_token', value='allow')\n            return response\n\n    def get(self, request):\n        return\n\n    def post(self, request):\n        print(request.COOKIES)\n        self.initial = request.POST\n        print(self.initial)\n        print(request.COOKIES)\n        # TODO we need direct user to home_page_logged_in\n        if request.COOKIES['post_token'] != 'allow':\n            return redirect('appoint:search_test')\n        if verify_sign_in(self.initial):\n            context = get_user_center_context(self.initial['name'])\n            response = render(request, self.success_template_name, context=context)\n            response.set_cookie(key='post_token', value='disable', expires=3600)\n            response.set_cookie(key='user_id', value=context['user'].id, expires=3600)\n            print('Response')\n            return response\n        else:\n            # form = self.form_class(self.initial)\n            # TODO we need to show user what's wrong with his account or password\n            return render(request, template_name=self.template_name, context={'error': '用户名或密码错误'})\n\n\ndef verify_sign_in(sign_in_data):\n    name = sign_in_data['name']\n    password = sign_in_data['password']\n    try:\n        encoded_password = User.objects.get(name=name).password\n        check = check_password(password=password, encoded=encoded_password)\n    except ObjectDoesNotExist:\n        return False\n    return check\n\n\nclass SignUpView(View):\n    form_class = SignUp\n    initial = {\"key\": \"value\"}\n    # TODO here we use the test html later we need to change it\n    template_name = \"login/sign_up.html\"\n    success_template_name = \"login/sign_up_success_test.html\"\n\n    def dispatch(self, request, *args, **kwargs):\n        if request.method == 'POST':\n            return self.post(request)\n        else:\n            form = SignUp()\n            response = render(request, 'login/sign_up.html', context={'sign_up_form': form})\n            response.set_cookie(key='post_token', value='allow', expires=3600)\n            return response\n\n    def get(self, request, *args, **kwargs):\n        # we don't need this yet\n        return\n\n    def post(self, request, *args, **kwargs):\n        self.initial = request.POST\n        print(self.initial)\n        form = self.form_class(\n            self.initial\n        )\n        if request.COOKIES['post_token'] != 'allow':\n            return redirect('appoint:search_test')\n        if self.initial['password'] == self.initial['repeat_password'] and form.is_valid():\n            print('No Wrong')\n            user_data = get_user_data(self.initial)\n            new_user = User.objects.create(\n                name=user_data['name'],\n                password=user_data['password'],\n                birth=user_data['birth'],\n                age=user_data['age'],\n                sex=user_data['sex'],\n                phone=user_data['phone'],\n                email=user_data['email'],\n                sign_up_time=user_data['sign_up_time'],\n                appoint_times=user_data['appoint_times'],\n                appoint_available=user_data['appoint_available']\n            )\n            new_user.save()\n            # response = HttpResponseRedirect('welcome=%s' % user_data['name'])\n            response = render(request, self.success_template_name)\n            response.set_cookie(key='post_token', value='disable', expires=3600)\n            return response\n        else:\n            errors = form.errors.as_data()\n            for error_key in errors.keys():\n                errors[error_key] = errors[error_key][0].message\n            if self.initial['password'] != self.initial['repeat_password']:\n                errors['repeat_password'] = '确认密码与密码不相同'\n            cleaned_data = form.cleaned_data\n            return render(request, template_name=self.template_name, context={'sign_up_form': form, 'errors': errors})\n\n\ndef get_user_data(form_data):\n    user_data = {}\n    user_data['name'] = form_data['name']\n    # Look OUT I use make_password here!\n    user_data['password'] = make_password(form_data['password'], None)\n    user_data['sex'] = True if form_data['sex'] == 'male' else False\n    user_data['phone'] = form_data['phone']\n    user_data['birth'] = form_data['birth']\n    user_data['email'] = form_data['email']\n    user_data['age'] = date.today().year - int(user_data['birth'][0:4])\n    user_data['sign_up_time'] = datetime.now()\n    # TODO we need to change the appoint time here later\n    user_data['appoint_times'] = 3\n    user_data['appoint_available'] = True\n    return user_data\n\n\ndef get_user_center_context(user_name):\n    # get user\n    sign_in_user = User.objects.get(name=user_name)\n    # get all registrations\n    all_orders = Order.objects.filter(patient=sign_in_user)\n    # get today registrations\n    today_date = datetime.today().date()\n    today_start_datetime = datetime(year=today_date.year, month=today_date.month, day=today_date.day)\n    today_end_datetime = datetime(year=today_date.year, month=today_date.month, day=today_date.day + 1)\n    today_orders = all_orders.filter(order_time__range=(today_start_datetime, today_end_datetime))\n    against_rule_orders = all_orders.filter(status=4)\n    history_orders = []\n    for order in all_orders:\n        if order not in today_orders:\n            history_orders.append(order)\n    context = {\n        'user': sign_in_user,\n        'today_orders': today_orders,\n        'history_orders': history_orders,\n        'today_date': today_date,\n        'against_rule_orders': against_rule_orders\n    }\n    return context
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- login/views.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ login/views.py	(date 1590076787429)
@@ -13,12 +13,20 @@
 from datetime import date
 from datetime import datetime
 from appoint.models import Order
+from login.models import User
 # Create your views here.
 
 
-def user_center(request, name):
-    context = get_user_center_context(name)
-    return render(request, template_name='login/user_center_test.html', context=context)
+def user_center(request):
+    if 'user_id' in request.COOKIES:
+        user_id = request.COOKIES['user_id']
+        name = User.objects.get(id=user_id).name
+        context = get_user_center_context(name)
+        response = render(request, template_name='login/user_center_test.html', context=context)
+        response.set_cookie(key='user_id', value=user_id, expires=3600)
+        return response
+    else:
+        return render(request, template_name='login/home_page_test.html')
 
 
 def logout(request):
Index: appoint/data.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from datetime import datetime, timedelta\nfrom .models import Department, Doctor, Schedule\nfrom math import ceil\nweekdays = {\n    1: '星期一',\n    2: '星期二',\n    3: '星期三',\n    4: '星期四',\n    5: '星期五',\n    6: '星期六',\n    7: '星期日'\n\n}\ndepartment_names = [\n        '儿科', '妇产科', '普外科', '泌尿外科', '神经外科', '心胸肿瘤外科', '骨科', '内科', '消化内科', '心内科', '呼吸内科', '眼科', '耳鼻喉科',\n        '口腔科', '皮肤性病科', '中医科']\ncheck_department_names = [\n        '眼库',\n        '病理科',\n        '输血科',\n        '药学部',\n        '检验科',\n        '营养科',\n        '核医学科',\n        '消毒供应科',\n        '血液净化科',\n        '医学影像科',\n        '超声影像科'\n    ]\ntypes = ['普通号', '专家号']\nmorning_afternoons = ['上午', '下午']\nappoint_basic_data = {\n    'departments': [{'id': Department.objects.get(name=name).id, 'name': name} for name in department_names],\n    'check_departments': [{'id': Department.objects.get(name=name).id, 'name': name} for name in check_department_names],\n    'types': [{'id': types.index(name), 'name': name} for name in types],\n    'dates': [{'text': str(datetime.today().date()+timedelta(days=i-1)) + weekdays[datetime.isoweekday(datetime.today().date()+timedelta(days=i-1))], 'id':i} for i in range(1, 8)],\n    'tests': {'id': 0},\n    'doctors': [{'id': doctor.id, 'name': doctor.name, 'sex': '男' if doctor.sex == 1 else '女',\n                 'department_name': doctor.department.name, 'department_id': doctor.department.id, 'title': doctor.title} for doctor in Doctor.objects.filter(title='主任医师')],\n    'schedules': [{'department_name': schedule.department.name, 'id': schedule.id} for schedule in Schedule.objects.filter(type=1, weekday=datetime.isoweekday(datetime.today().date()), morning_afternoon=0)],\n    'schedule_objs': Schedule.objects.filter(type=1, weekday=datetime.isoweekday(datetime.today().date()), morning_afternoon=0),\n    'doctor_objs': Doctor.objects.all(),\n    'pages': list(range(1, ceil(len(Doctor.objects.filter(title='主任医师'))/8)+1)),\n    'morning_afternoons': [{'id': morning_afternoons.index(morning_afternoon), 'name': morning_afternoon} for morning_afternoon in morning_afternoons],\n    'picked_type': 1,\n    'picked_page': 1,\n    'picked_date': 0,\n    'picked_morning_afternoon': 0,\n    'page_schedules': [],\n}\nappoint_basic_data['page_doctors'] = appoint_basic_data['doctors'][0: 8]\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- appoint/data.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ appoint/data.py	(date 1590075244344)
@@ -44,7 +44,7 @@
     'morning_afternoons': [{'id': morning_afternoons.index(morning_afternoon), 'name': morning_afternoon} for morning_afternoon in morning_afternoons],
     'picked_type': 1,
     'picked_page': 1,
-    'picked_date': 0,
+    'picked_date': datetime.isoweekday(datetime.today().date()),
     'picked_morning_afternoon': 0,
     'page_schedules': [],
 }
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"BranchesTreeState\">\n    <expand>\n      <path>\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n        <item name=\"LOCAL_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n      </path>\n      <path>\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n      </path>\n      <path>\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\n        <item name=\"GROUP_NODE:origin\" type=\"e8cecc67:BranchNodeDescriptor\" />\n      </path>\n    </expand>\n    <select />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"f90b6668-b1e4-484c-9ae5-8088e700936a\" name=\"Default Changelist\" comment=\"\">\n      <change afterPath=\"$PROJECT_DIR$/pay/__init__.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/admin.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/alipay.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/alipay/alipay_keys/alipay_public.txt\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/alipay/alipay_keys/app_private.txt\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/alipay/alipay_keys/app_public.txt\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/apps.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/migrations/__init__.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/models.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/tests.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/urls.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/pay/views.py\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/templates/login/sign_up.html\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/templates/login/sign_up_success_test.html\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/templates/pay/index.html\" afterDir=\"false\" />\n      <change afterPath=\"$PROJECT_DIR$/templates/pay/success.html\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/HIS/settings.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/HIS/settings.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/HIS/urls.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/HIS/urls.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/appoint/views.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/appoint/views.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/data.db\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/data.db\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/login/urls.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/login/urls.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/login/validators.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/login/validators.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/login/views.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/login/views.py\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/templates/appoint/search_test.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/appoint/search_test.html\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/templates/appoint/submit_test.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/appoint/submit_test.html\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/templates/login/home_page_test.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/login/home_page_test.html\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/templates/login/user_center_test.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/templates/login/user_center_test.html\" afterDir=\"false\" />\n    </list>\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"DatabaseView\">\n    <option name=\"SHOW_INTERMEDIATE\" value=\"true\" />\n    <option name=\"GROUP_DATA_SOURCES\" value=\"true\" />\n    <option name=\"GROUP_SCHEMA\" value=\"true\" />\n    <option name=\"GROUP_CONTENTS\" value=\"false\" />\n    <option name=\"SORT_POSITIONED\" value=\"false\" />\n    <option name=\"SHOW_EMPTY_GROUPS\" value=\"false\" />\n    <option name=\"AUTO_SCROLL_FROM_SOURCE\" value=\"false\" />\n    <option name=\"HIDDEN_KINDS\">\n      <set />\n    </option>\n    <expand />\n    <select />\n  </component>\n  <component name=\"DjangoConsoleOptions\" custom-start-script=\"import sys; print('Python %s on %s' % (sys.version, sys.platform))&#10;import django; print('Django %s' % django.get_version())&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;if 'setup' in dir(django): django.setup()&#10;import django_manage_shell; django_manage_shell.run(PROJECT_ROOT)\">\n    <option name=\"myCustomStartScript\" value=\"import sys; print('Python %s on %s' % (sys.version, sys.platform))&#10;import django; print('Django %s' % django.get_version())&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;if 'setup' in dir(django): django.setup()&#10;import django_manage_shell; django_manage_shell.run(PROJECT_ROOT)\" />\n  </component>\n  <component name=\"FileTemplateManagerImpl\">\n    <option name=\"RECENT_TEMPLATES\">\n      <list>\n        <option value=\"Python Script\" />\n        <option value=\"HTML File\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"Git.Settings\">\n    <option name=\"PREVIOUS_COMMIT_AUTHORS\">\n      <list>\n        <option value=\"AntonioTan &lt;congmi@outlook.com&gt;\" />\n      </list>\n    </option>\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\n      <map>\n        <entry key=\"$PROJECT_DIR$\" value=\"login\" />\n      </map>\n    </option>\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\n  </component>\n  <component name=\"ProjectId\" id=\"1aJ2TwJkDQJStDp62mfur7poRgu\" />\n  <component name=\"ProjectLevelVcsManager\" settingsEditedManually=\"true\">\n    <ConfirmationsSetting value=\"2\" id=\"Add\" />\n  </component>\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </component>\n  <component name=\"PropertiesComponent\">\n    <property name=\"ASKED_ADD_EXTERNAL_FILES\" value=\"true\" />\n    <property name=\"DefaultHtmlFileTemplate\" value=\"HTML File\" />\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\n    <property name=\"SHARE_PROJECT_CONFIGURATION_FILES\" value=\"true\" />\n    <property name=\"WebServerToolWindowFactoryState\" value=\"false\" />\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$/pay/alipay/alipay_keys\" />\n    <property name=\"node.js.detected.package.eslint\" value=\"true\" />\n    <property name=\"node.js.detected.package.tslint\" value=\"true\" />\n    <property name=\"node.js.path.for.package.eslint\" value=\"project\" />\n    <property name=\"node.js.path.for.package.tslint\" value=\"project\" />\n    <property name=\"node.js.selected.package.eslint\" value=\"(autodetect)\" />\n    <property name=\"node.js.selected.package.tslint\" value=\"(autodetect)\" />\n    <property name=\"settings.editor.selected.configurable\" value=\"com.jetbrains.python.configuration.PyActiveSdkModuleConfigurable\" />\n  </component>\n  <component name=\"PyConsoleOptionsProvider\">\n    <option name=\"myPythonConsoleState\">\n      <console-settings module-name=\"HIS\" is-module-sdk=\"true\">\n        <option name=\"myUseModuleSdk\" value=\"true\" />\n        <option name=\"myModuleName\" value=\"HIS\" />\n      </console-settings>\n    </option>\n  </component>\n  <component name=\"RecentsManager\">\n    <key name=\"CopyFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/pay/alipay/alipay_keys\" />\n      <recent name=\"$PROJECT_DIR$/templates/login\" />\n      <recent name=\"$PROJECT_DIR$/templates/appoint\" />\n      <recent name=\"$PROJECT_DIR$/appoint/static/appoint/imgs\" />\n      <recent name=\"$PROJECT_DIR$/data\" />\n    </key>\n    <key name=\"MoveFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/templates\" />\n      <recent name=\"$PROJECT_DIR$/HIS\" />\n      <recent name=\"$PROJECT_DIR$\" />\n    </key>\n  </component>\n  <component name=\"RunManager\" selected=\"Python.data_create\">\n    <configuration name=\"data_create\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\" nameIsGenerated=\"true\">\n      <module name=\"HIS\" />\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\n      <option name=\"PARENT_ENVS\" value=\"true\" />\n      <envs>\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\n      </envs>\n      <option name=\"SDK_HOME\" value=\"\" />\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$/appoint\" />\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/HIS/data_create.py\" />\n      <option name=\"PARAMETERS\" value=\"\" />\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\n      <option name=\"MODULE_MODE\" value=\"false\" />\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\n      <option name=\"INPUT_FILE\" value=\"\" />\n      <method v=\"2\" />\n    </configuration>\n    <configuration name=\"views\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\" nameIsGenerated=\"true\">\n      <module name=\"HIS\" />\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\n      <option name=\"PARENT_ENVS\" value=\"true\" />\n      <envs>\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\n      </envs>\n      <option name=\"SDK_HOME\" value=\"\" />\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$/appoint\" />\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/appoint/views.py\" />\n      <option name=\"PARAMETERS\" value=\"\" />\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\n      <option name=\"MODULE_MODE\" value=\"false\" />\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\n      <option name=\"INPUT_FILE\" value=\"\" />\n      <method v=\"2\" />\n    </configuration>\n    <configuration name=\"HIS\" type=\"Python.DjangoServer\" factoryName=\"Django server\">\n      <module name=\"HIS\" />\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\n      <option name=\"PARENT_ENVS\" value=\"true\" />\n      <envs>\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\n        <env name=\"DJANGO_SETTINGS_MODULE\" value=\"HIS.settings\" />\n      </envs>\n      <option name=\"SDK_HOME\" value=\"\" />\n      <option name=\"WORKING_DIRECTORY\" value=\"\" />\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\n      <option name=\"launchJavascriptDebuger\" value=\"false\" />\n      <option name=\"port\" value=\"8000\" />\n      <option name=\"host\" value=\"\" />\n      <option name=\"additionalOptions\" value=\"\" />\n      <option name=\"browserUrl\" value=\"\" />\n      <option name=\"runTestServer\" value=\"false\" />\n      <option name=\"runNoReload\" value=\"false\" />\n      <option name=\"useCustomRunCommand\" value=\"false\" />\n      <option name=\"customRunCommand\" value=\"\" />\n      <method v=\"2\" />\n    </configuration>\n    <recent_temporary>\n      <list>\n        <item itemvalue=\"Python.data_create\" />\n        <item itemvalue=\"Python.views\" />\n      </list>\n    </recent_temporary>\n  </component>\n  <component name=\"SvnConfiguration\">\n    <configuration />\n  </component>\n  <component name=\"TaskManager\">\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\n      <changelist id=\"f90b6668-b1e4-484c-9ae5-8088e700936a\" name=\"Default Changelist\" comment=\"\" />\n      <created>1586439387121</created>\n      <option name=\"number\" value=\"Default\" />\n      <option name=\"presentableId\" value=\"Default\" />\n      <updated>1586439387121</updated>\n      <workItem from=\"1586439389991\" duration=\"1176000\" />\n      <workItem from=\"1586799539164\" duration=\"1377000\" />\n      <workItem from=\"1586833432923\" duration=\"11223000\" />\n      <workItem from=\"1587026891579\" duration=\"20040000\" />\n      <workItem from=\"1587223106720\" duration=\"281000\" />\n      <workItem from=\"1588925073826\" duration=\"12152000\" />\n      <workItem from=\"1589198436624\" duration=\"4266000\" />\n      <workItem from=\"1589419564432\" duration=\"118000\" />\n      <workItem from=\"1589420001583\" duration=\"178000\" />\n      <workItem from=\"1589521864072\" duration=\"12152000\" />\n      <workItem from=\"1589616840392\" duration=\"4102000\" />\n      <workItem from=\"1589638521116\" duration=\"12843000\" />\n      <workItem from=\"1589684600101\" duration=\"1685000\" />\n      <workItem from=\"1589688672922\" duration=\"195000\" />\n      <workItem from=\"1589689093296\" duration=\"36429000\" />\n      <workItem from=\"1589815659672\" duration=\"31000\" />\n      <workItem from=\"1589848129137\" duration=\"136000\" />\n      <workItem from=\"1589851237315\" duration=\"173000\" />\n      <workItem from=\"1589851427545\" duration=\"599000\" />\n      <workItem from=\"1589960419281\" duration=\"32270000\" />\n    </task>\n    <task id=\"LOCAL-00001\" summary=\"The first version\">\n      <created>1586439626297</created>\n      <option name=\"number\" value=\"00001\" />\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1586439626297</updated>\n    </task>\n    <task id=\"LOCAL-00002\" summary=\"The first version\">\n      <created>1586439700510</created>\n      <option name=\"number\" value=\"00002\" />\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1586439700510</updated>\n    </task>\n    <task id=\"LOCAL-00003\" summary=\"The first version\">\n      <created>1586439722311</created>\n      <option name=\"number\" value=\"00003\" />\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1586439722311</updated>\n    </task>\n    <task id=\"LOCAL-00004\" summary=\"Just create a model named User\">\n      <created>1586532793583</created>\n      <option name=\"number\" value=\"00004\" />\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1586532793583</updated>\n    </task>\n    <task id=\"LOCAL-00005\" summary=\"Almost finish the login module&#10;Still need to check out the bug\">\n      <created>1587047964929</created>\n      <option name=\"number\" value=\"00005\" />\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587047964929</updated>\n    </task>\n    <task id=\"LOCAL-00006\" summary=\"I just finish some validators for the User sign up\">\n      <created>1587049694139</created>\n      <option name=\"number\" value=\"00006\" />\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587049694139</updated>\n    </task>\n    <task id=\"LOCAL-00007\" summary=\"I add some tips and requirements for front-end developers.\">\n      <created>1587050622193</created>\n      <option name=\"number\" value=\"00007\" />\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587050622193</updated>\n    </task>\n    <task id=\"LOCAL-00008\" summary=\"Add the home page sign in\">\n      <created>1587108856466</created>\n      <option name=\"number\" value=\"00008\" />\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587108856466</updated>\n    </task>\n    <task id=\"LOCAL-00009\" summary=\"Add FYI for this html\">\n      <created>1587109163998</created>\n      <option name=\"number\" value=\"00009\" />\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587109163998</updated>\n    </task>\n    <task id=\"LOCAL-00010\" summary=\"Add FYI for home_page module\">\n      <created>1587109191358</created>\n      <option name=\"number\" value=\"00010\" />\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587109191358</updated>\n    </task>\n    <task id=\"LOCAL-00011\" summary=\"merge requirement\">\n      <created>1587223353195</created>\n      <option name=\"number\" value=\"00011\" />\n      <option name=\"presentableId\" value=\"LOCAL-00011\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587223353195</updated>\n    </task>\n    <task id=\"LOCAL-00012\" summary=\"model change\">\n      <created>1587369953940</created>\n      <option name=\"number\" value=\"00012\" />\n      <option name=\"presentableId\" value=\"LOCAL-00012\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587369953940</updated>\n    </task>\n    <task id=\"LOCAL-00013\" summary=\"I just finish some validators for the User sign up\">\n      <created>1587370051379</created>\n      <option name=\"number\" value=\"00013\" />\n      <option name=\"presentableId\" value=\"LOCAL-00013\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587370051379</updated>\n    </task>\n    <task id=\"LOCAL-00014\" summary=\"change the models.py\">\n      <created>1587370350511</created>\n      <option name=\"number\" value=\"00014\" />\n      <option name=\"presentableId\" value=\"LOCAL-00014\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587370350511</updated>\n    </task>\n    <task id=\"LOCAL-00015\" summary=\"add django-crontab\">\n      <created>1587370383404</created>\n      <option name=\"number\" value=\"00015\" />\n      <option name=\"presentableId\" value=\"LOCAL-00015\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587370383404</updated>\n    </task>\n    <task id=\"LOCAL-00016\" summary=\"model 2.0\">\n      <created>1587385074576</created>\n      <option name=\"number\" value=\"00016\" />\n      <option name=\"presentableId\" value=\"LOCAL-00016\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587385074576</updated>\n    </task>\n    <task id=\"LOCAL-00017\" summary=\"CRONJOB for some time schedule jobs\">\n      <created>1587385176157</created>\n      <option name=\"number\" value=\"00017\" />\n      <option name=\"presentableId\" value=\"LOCAL-00017\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587385176157</updated>\n    </task>\n    <task id=\"LOCAL-00018\" summary=\"Add cronjob settings  the test of which has been verified\">\n      <created>1587385210947</created>\n      <option name=\"number\" value=\"00018\" />\n      <option name=\"presentableId\" value=\"LOCAL-00018\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1587385210947</updated>\n    </task>\n    <task id=\"LOCAL-00019\" summary=\"new version of register_all_test.html\">\n      <created>1588927437015</created>\n      <option name=\"number\" value=\"00019\" />\n      <option name=\"presentableId\" value=\"LOCAL-00019\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1588927437015</updated>\n    </task>\n    <task id=\"LOCAL-00020\" summary=\"new version of appoint urls\">\n      <created>1588934504034</created>\n      <option name=\"number\" value=\"00020\" />\n      <option name=\"presentableId\" value=\"LOCAL-00020\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1588934504034</updated>\n    </task>\n    <task id=\"LOCAL-00021\" summary=\"Well appoint version 1 &#10;now you can pick a date&#10;but other picks work the same  way\">\n      <created>1588948526768</created>\n      <option name=\"number\" value=\"00021\" />\n      <option name=\"presentableId\" value=\"LOCAL-00021\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1588948526768</updated>\n    </task>\n    <task id=\"LOCAL-00022\" summary=\"Add the appoint module setting into HIS\">\n      <created>1588948553573</created>\n      <option name=\"number\" value=\"00022\" />\n      <option name=\"presentableId\" value=\"LOCAL-00022\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1588948553573</updated>\n    </task>\n    <task id=\"LOCAL-00023\" summary=\"Create fake data into database\">\n      <created>1589642594556</created>\n      <option name=\"number\" value=\"00023\" />\n      <option name=\"presentableId\" value=\"LOCAL-00023\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589642594556</updated>\n    </task>\n    <task id=\"LOCAL-00024\" summary=\"data from zxc\">\n      <created>1589642605356</created>\n      <option name=\"number\" value=\"00024\" />\n      <option name=\"presentableId\" value=\"LOCAL-00024\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589642605356</updated>\n    </task>\n    <task id=\"LOCAL-00025\" summary=\"create fake data into database\">\n      <created>1589642619929</created>\n      <option name=\"number\" value=\"00025\" />\n      <option name=\"presentableId\" value=\"LOCAL-00025\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589642619929</updated>\n    </task>\n    <task id=\"LOCAL-00026\" summary=\"a few changes recently\">\n      <created>1589642960971</created>\n      <option name=\"number\" value=\"00026\" />\n      <option name=\"presentableId\" value=\"LOCAL-00026\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589642960971</updated>\n    </task>\n    <task id=\"LOCAL-00027\" summary=\"search_test html created\">\n      <created>1589677352025</created>\n      <option name=\"number\" value=\"00027\" />\n      <option name=\"presentableId\" value=\"LOCAL-00027\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589677352025</updated>\n    </task>\n    <task id=\"LOCAL-00028\" summary=\"search_test html created\">\n      <created>1589678705234</created>\n      <option name=\"number\" value=\"00028\" />\n      <option name=\"presentableId\" value=\"LOCAL-00028\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589678705234</updated>\n    </task>\n    <task id=\"LOCAL-00029\" summary=\"static setting\">\n      <created>1589679133607</created>\n      <option name=\"number\" value=\"00029\" />\n      <option name=\"presentableId\" value=\"LOCAL-00029\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589679133607</updated>\n    </task>\n    <task id=\"LOCAL-00030\" summary=\"dynamically display the appointment finally\">\n      <created>1589716343586</created>\n      <option name=\"number\" value=\"00030\" />\n      <option name=\"presentableId\" value=\"LOCAL-00030\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589716343586</updated>\n    </task>\n    <task id=\"LOCAL-00031\" summary=\"dynamically display the appointment finally\">\n      <created>1589851442412</created>\n      <option name=\"number\" value=\"00031\" />\n      <option name=\"presentableId\" value=\"LOCAL-00031\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589851442412</updated>\n    </task>\n    <task id=\"LOCAL-00032\" summary=\"dynamically display the appointment finally\">\n      <created>1589851470609</created>\n      <option name=\"number\" value=\"00032\" />\n      <option name=\"presentableId\" value=\"LOCAL-00032\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589851470609</updated>\n    </task>\n    <task id=\"LOCAL-00033\" summary=\"dynamically display the appointment finally\">\n      <created>1589851563436</created>\n      <option name=\"number\" value=\"00033\" />\n      <option name=\"presentableId\" value=\"LOCAL-00033\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589851563436</updated>\n    </task>\n    <task id=\"LOCAL-00034\" summary=\"user_center added back_end\">\n      <created>1589975238718</created>\n      <option name=\"number\" value=\"00034\" />\n      <option name=\"presentableId\" value=\"LOCAL-00034\" />\n      <option name=\"project\" value=\"LOCAL\" />\n      <updated>1589975238718</updated>\n    </task>\n    <option name=\"localTasksCounter\" value=\"35\" />\n    <servers />\n  </component>\n  <component name=\"TypeScriptGeneratedFilesManager\">\n    <option name=\"version\" value=\"2\" />\n  </component>\n  <component name=\"Vcs.Log.History.Properties\">\n    <option name=\"COLUMN_ORDER\">\n      <list>\n        <option value=\"0\" />\n        <option value=\"2\" />\n        <option value=\"3\" />\n        <option value=\"1\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"Vcs.Log.Tabs.Properties\">\n    <option name=\"TAB_STATES\">\n      <map>\n        <entry key=\"1\">\n          <value>\n            <State>\n              <option name=\"SHOW_ONLY_AFFECTED_CHANGES\" value=\"true\" />\n              <option name=\"FILTERS\">\n                <map>\n                  <entry key=\"branch\">\n                    <value>\n                      <list>\n                        <option value=\"HEAD\" />\n                      </list>\n                    </value>\n                  </entry>\n                  <entry key=\"structure\">\n                    <value>\n                      <list>\n                        <option value=\"dir:/Users/tantianyi/PycharmProjects/HIS/HIS\" />\n                      </list>\n                    </value>\n                  </entry>\n                </map>\n              </option>\n            </State>\n          </value>\n        </entry>\n        <entry key=\"2\">\n          <value>\n            <State>\n              <option name=\"SHOW_ONLY_AFFECTED_CHANGES\" value=\"true\" />\n              <option name=\"FILTERS\">\n                <map>\n                  <entry key=\"branch\">\n                    <value>\n                      <list>\n                        <option value=\"HEAD\" />\n                      </list>\n                    </value>\n                  </entry>\n                  <entry key=\"structure\">\n                    <value>\n                      <list>\n                        <option value=\"dir:/Users/tantianyi/PycharmProjects/HIS/templates\" />\n                      </list>\n                    </value>\n                  </entry>\n                </map>\n              </option>\n            </State>\n          </value>\n        </entry>\n        <entry key=\"MAIN\">\n          <value>\n            <State />\n          </value>\n        </entry>\n      </map>\n    </option>\n    <option name=\"oldMeFiltersMigrated\" value=\"true\" />\n  </component>\n  <component name=\"VcsManagerConfiguration\">\n    <option name=\"ADD_EXTERNAL_FILES_SILENTLY\" value=\"true\" />\n    <MESSAGE value=\"Almost finish the login module&#10;Still need to check out the bug\" />\n    <MESSAGE value=\"I add some tips and requirements for front-end developers.\" />\n    <MESSAGE value=\"Add the home page sign in\" />\n    <MESSAGE value=\"Add FYI for this html\" />\n    <MESSAGE value=\"Add FYI for home_page module\" />\n    <MESSAGE value=\"merge requirement\" />\n    <MESSAGE value=\"model change\" />\n    <MESSAGE value=\"I just finish some validators for the User sign up\" />\n    <MESSAGE value=\"change the models.py\" />\n    <MESSAGE value=\"add django-crontab\" />\n    <MESSAGE value=\"model 2.0\" />\n    <MESSAGE value=\"CRONJOB for some time schedule jobs\" />\n    <MESSAGE value=\"Add cronjob settings  the test of which has been verified\" />\n    <MESSAGE value=\"new version of register_all_test.html\" />\n    <MESSAGE value=\"new version of appoint urls\" />\n    <MESSAGE value=\"Well appoint version 1 &#10;now you can pick a date&#10;but other picks work the same  way\" />\n    <MESSAGE value=\"Add the appoint module setting into HIS\" />\n    <MESSAGE value=\"Create fake data into database\" />\n    <MESSAGE value=\"data from zxc\" />\n    <MESSAGE value=\"create fake data into database\" />\n    <MESSAGE value=\"a few changes recently\" />\n    <MESSAGE value=\"search_test html created\" />\n    <MESSAGE value=\"static setting\" />\n    <MESSAGE value=\"dynamically display the appointment finally\" />\n    <MESSAGE value=\"user_center added back_end\" />\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"user_center added back_end\" />\n    <option name=\"UPDATE_GROUP_BY_PACKAGES\" value=\"true\" />\n  </component>\n  <component name=\"WindowStateProjectService\">\n    <state x=\"440\" y=\"192\" key=\"#Deployment\" timestamp=\"1586798758901\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"440\" y=\"192\" key=\"#Deployment/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586798758901\" />\n    <state x=\"440\" y=\"192\" key=\"#Inspections\" timestamp=\"1587369925858\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"440\" y=\"192\" key=\"#Inspections/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587369925858\" />\n    <state x=\"440\" y=\"192\" key=\"#Notifications\" timestamp=\"1586442677490\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"440\" y=\"192\" key=\"#Notifications/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442677490\" />\n    <state x=\"304\" y=\"188\" width=\"1071\" height=\"715\" key=\"#com.intellij.execution.impl.EditConfigurationsDialog\" timestamp=\"1590031639013\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"304\" y=\"188\" width=\"1071\" height=\"715\" key=\"#com.intellij.execution.impl.EditConfigurationsDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1590031639013\" />\n    <state x=\"572\" y=\"335\" key=\"#com.intellij.fileTypes.FileTypeChooser\" timestamp=\"1589993901411\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"572\" y=\"335\" key=\"#com.intellij.fileTypes.FileTypeChooser/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589993901411\" />\n    <state x=\"481\" y=\"302\" key=\"#com.intellij.ide.fileTemplates.ui.ConfigureTemplatesDialog\" timestamp=\"1586442418494\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"481\" y=\"302\" key=\"#com.intellij.ide.fileTemplates.ui.ConfigureTemplatesDialog/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442418494\" />\n    <state x=\"432\" y=\"130\" key=\"CommitChangelistDialog2\" timestamp=\"1589975238531\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"432\" y=\"130\" key=\"CommitChangelistDialog2/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442514800\" />\n    <state x=\"432\" y=\"130\" key=\"CommitChangelistDialog2/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589975238531\" />\n    <state x=\"168\" y=\"94\" width=\"1344\" height=\"840\" key=\"DiffContextDialog\" timestamp=\"1587223334968\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"168\" y=\"94\" width=\"1344\" height=\"840\" key=\"DiffContextDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587223334967\" />\n    <state x=\"647\" y=\"449\" key=\"Github.CreateGistDialog\" timestamp=\"1586439474296\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"647\" y=\"449\" key=\"Github.CreateGistDialog/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586439474296\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.bottom\" timestamp=\"1589729168198\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"1638\" height=\"295\" key=\"GridCell.Tab.0.bottom/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442029189\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.bottom/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589729168198\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.bottom/0.23.1680.980@0.23.1680.980\" timestamp=\"1589684549009\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.center\" timestamp=\"1589729168197\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"1638\" height=\"295\" key=\"GridCell.Tab.0.center/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442029188\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.center/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589729168197\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.center/0.23.1680.980@0.23.1680.980\" timestamp=\"1589684549008\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.left\" timestamp=\"1589729168196\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"1638\" height=\"295\" key=\"GridCell.Tab.0.left/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442029187\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.left/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589729168196\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.left/0.23.1680.980@0.23.1680.980\" timestamp=\"1589684549007\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.right\" timestamp=\"1589729168197\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"1638\" height=\"295\" key=\"GridCell.Tab.0.right/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586442029189\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.right/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589729168197\" />\n    <state width=\"819\" height=\"294\" key=\"GridCell.Tab.0.right/0.23.1680.980@0.23.1680.980\" timestamp=\"1589684549009\" />\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.bottom\" timestamp=\"1589637102728\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.bottom/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589637102728\" />\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.center\" timestamp=\"1589637102727\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.center/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589637102727\" />\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.left\" timestamp=\"1589637102726\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.left/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589637102726\" />\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.right\" timestamp=\"1589637102727\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state width=\"819\" height=\"363\" key=\"GridCell.Tab.1.right/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589637102727\" />\n    <state x=\"168\" y=\"94\" key=\"MergeDialog\" timestamp=\"1587223184303\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"168\" y=\"94\" key=\"MergeDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587223184303\" />\n    <state x=\"553\" y=\"249\" key=\"MultipleFileMergeDialog\" timestamp=\"1587223184346\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"553\" y=\"249\" key=\"MultipleFileMergeDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587223184346\" />\n    <state x=\"349\" y=\"164\" key=\"SettingsEditor\" timestamp=\"1590028900797\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"349\" y=\"164\" key=\"SettingsEditor/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1590028900797\" />\n    <state x=\"440\" y=\"266\" key=\"Vcs.Push.Dialog.v2\" timestamp=\"1589851481007\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"440\" y=\"266\" key=\"Vcs.Push.Dialog.v2/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586443483926\" />\n    <state x=\"440\" y=\"266\" key=\"Vcs.Push.Dialog.v2/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589851481007\" />\n    <state x=\"638\" y=\"267\" key=\"VcsDiffUtil.ChangesDialog\" timestamp=\"1589642735540\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"638\" y=\"267\" key=\"VcsDiffUtil.ChangesDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589642735540\" />\n    <state x=\"496\" y=\"359\" key=\"com.intellij.ide.util.TipDialog\" timestamp=\"1589688681304\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"496\" y=\"359\" key=\"com.intellij.ide.util.TipDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589688681304\" />\n    <state x=\"496\" y=\"358\" key=\"com.intellij.ide.util.TipDialog/0.23.1680.980@0.23.1680.980\" timestamp=\"1589419564457\" />\n    <state x=\"594\" y=\"246\" key=\"git4idea.branch.GitSmartOperationDialog\" timestamp=\"1587223136247\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"594\" y=\"246\" key=\"git4idea.branch.GitSmartOperationDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587223136247\" />\n    <state x=\"622\" y=\"325\" key=\"git4idea.merge.GitMergeDialog\" timestamp=\"1587223323444\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"622\" y=\"325\" key=\"git4idea.merge.GitMergeDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1587223323444\" />\n    <state x=\"551\" y=\"325\" key=\"git4idea.merge.GitPullDialog\" timestamp=\"1589986392325\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"551\" y=\"325\" key=\"git4idea.merge.GitPullDialog/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1586447371204\" />\n    <state x=\"551\" y=\"325\" key=\"git4idea.merge.GitPullDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1589986392325\" />\n    <state x=\"602\" y=\"165\" key=\"refactoring.ChangeSignatureDialog\" timestamp=\"1588927230241\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"602\" y=\"165\" key=\"refactoring.ChangeSignatureDialog/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1588927230241\" />\n    <state x=\"505\" y=\"233\" width=\"670\" height=\"676\" key=\"search.everywhere.popup\" timestamp=\"1590028869053\">\n      <screen x=\"0\" y=\"0\" width=\"1680\" height=\"1050\" />\n    </state>\n    <state x=\"505\" y=\"233\" width=\"670\" height=\"676\" key=\"search.everywhere.popup/0.0.1680.1050@0.0.1680.1050\" timestamp=\"1590028869053\" />\n    <state x=\"505\" y=\"233\" width=\"670\" height=\"676\" key=\"search.everywhere.popup/0.23.1680.980@0.23.1680.980\" timestamp=\"1589689341400\" />\n  </component>\n  <component name=\"XDebuggerManager\">\n    <breakpoint-manager>\n      <breakpoints>\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\n          <url>file://$PROJECT_DIR$/appoint/forms.py</url>\n          <line>16</line>\n          <option name=\"timeStamp\" value=\"1\" />\n        </line-breakpoint>\n      </breakpoints>\n    </breakpoint-manager>\n  </component>\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\n    <SUITE FILE_PATH=\"coverage/HIS$views.coverage\" NAME=\"views Coverage Results\" MODIFIED=\"1589709816884\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$/appoint\" />\n    <SUITE FILE_PATH=\"coverage/HIS$data_create.coverage\" NAME=\"data_create Coverage Results\" MODIFIED=\"1589728945689\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$/appoint\" />\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/workspace.xml	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ .idea/workspace.xml	(date 1590248853331)
@@ -20,33 +20,16 @@
   </component>
   <component name="ChangeListManager">
     <list default="true" id="f90b6668-b1e4-484c-9ae5-8088e700936a" name="Default Changelist" comment="">
-      <change afterPath="$PROJECT_DIR$/pay/__init__.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/admin.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/alipay.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/alipay/alipay_keys/alipay_public.txt" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/alipay/alipay_keys/app_private.txt" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/alipay/alipay_keys/app_public.txt" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/apps.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/migrations/__init__.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/models.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/tests.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/urls.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/pay/views.py" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/templates/login/sign_up.html" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/templates/login/sign_up_success_test.html" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/templates/pay/index.html" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/templates/pay/success.html" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/HIS/settings.py" beforeDir="false" afterPath="$PROJECT_DIR$/HIS/settings.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/HIS/urls.py" beforeDir="false" afterPath="$PROJECT_DIR$/HIS/urls.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/appoint/data.py" beforeDir="false" afterPath="$PROJECT_DIR$/appoint/data.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/appoint/views.py" beforeDir="false" afterPath="$PROJECT_DIR$/appoint/views.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/data.db" beforeDir="false" afterPath="$PROJECT_DIR$/data.db" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/login/urls.py" beforeDir="false" afterPath="$PROJECT_DIR$/login/urls.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/login/validators.py" beforeDir="false" afterPath="$PROJECT_DIR$/login/validators.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/login/views.py" beforeDir="false" afterPath="$PROJECT_DIR$/login/views.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/pay/urls.py" beforeDir="false" afterPath="$PROJECT_DIR$/pay/urls.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/pay/views.py" beforeDir="false" afterPath="$PROJECT_DIR$/pay/views.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/templates/appoint/search_test.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/appoint/search_test.html" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/templates/appoint/submit_test.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/appoint/submit_test.html" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/templates/login/home_page_test.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/login/home_page_test.html" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/templates/login/user_center_test.html" beforeDir="false" afterPath="$PROJECT_DIR$/templates/login/user_center_test.html" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
@@ -106,7 +89,7 @@
     <property name="RunOnceActivity.ShowReadmeOnStart" value="true" />
     <property name="SHARE_PROJECT_CONFIGURATION_FILES" value="true" />
     <property name="WebServerToolWindowFactoryState" value="false" />
-    <property name="last_opened_file_path" value="$PROJECT_DIR$/pay/alipay/alipay_keys" />
+    <property name="last_opened_file_path" value="$PROJECT_DIR$" />
     <property name="node.js.detected.package.eslint" value="true" />
     <property name="node.js.detected.package.tslint" value="true" />
     <property name="node.js.path.for.package.eslint" value="project" />
@@ -242,7 +225,8 @@
       <workItem from="1589848129137" duration="136000" />
       <workItem from="1589851237315" duration="173000" />
       <workItem from="1589851427545" duration="599000" />
-      <workItem from="1589960419281" duration="32270000" />
+      <workItem from="1589960419281" duration="37057000" />
+      <workItem from="1590240995752" duration="1515000" />
     </task>
     <task id="LOCAL-00001" summary="The first version">
       <created>1586439626297</created>
@@ -482,7 +466,14 @@
       <option name="project" value="LOCAL" />
       <updated>1589975238718</updated>
     </task>
-    <option name="localTasksCounter" value="35" />
+    <task id="LOCAL-00035" summary="Well Too many stuff">
+      <created>1590073715303</created>
+      <option name="number" value="00035" />
+      <option name="presentableId" value="LOCAL-00035" />
+      <option name="project" value="LOCAL" />
+      <updated>1590073715303</updated>
+    </task>
+    <option name="localTasksCounter" value="36" />
     <servers />
   </component>
   <component name="TypeScriptGeneratedFilesManager">
@@ -562,7 +553,6 @@
   </component>
   <component name="VcsManagerConfiguration">
     <option name="ADD_EXTERNAL_FILES_SILENTLY" value="true" />
-    <MESSAGE value="Almost finish the login module&#10;Still need to check out the bug" />
     <MESSAGE value="I add some tips and requirements for front-end developers." />
     <MESSAGE value="Add the home page sign in" />
     <MESSAGE value="Add FYI for this html" />
@@ -587,7 +577,8 @@
     <MESSAGE value="static setting" />
     <MESSAGE value="dynamically display the appointment finally" />
     <MESSAGE value="user_center added back_end" />
-    <option name="LAST_COMMIT_MESSAGE" value="user_center added back_end" />
+    <MESSAGE value="Well Too many stuff" />
+    <option name="LAST_COMMIT_MESSAGE" value="Well Too many stuff" />
     <option name="UPDATE_GROUP_BY_PACKAGES" value="true" />
   </component>
   <component name="WindowStateProjectService">
@@ -615,11 +606,11 @@
       <screen x="0" y="0" width="1680" height="1050" />
     </state>
     <state x="481" y="302" key="#com.intellij.ide.fileTemplates.ui.ConfigureTemplatesDialog/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050" timestamp="1586442418494" />
-    <state x="432" y="130" key="CommitChangelistDialog2" timestamp="1589975238531">
+    <state x="432" y="130" key="CommitChangelistDialog2" timestamp="1590073715105">
       <screen x="0" y="0" width="1680" height="1050" />
     </state>
     <state x="432" y="130" key="CommitChangelistDialog2/-3840.-1149.3840.2160/0.0.1680.1050@0.0.1680.1050" timestamp="1586442514800" />
-    <state x="432" y="130" key="CommitChangelistDialog2/0.0.1680.1050@0.0.1680.1050" timestamp="1589975238531" />
+    <state x="432" y="130" key="CommitChangelistDialog2/0.0.1680.1050@0.0.1680.1050" timestamp="1590073715105" />
     <state x="168" y="94" width="1344" height="840" key="DiffContextDialog" timestamp="1587223334968">
       <screen x="0" y="0" width="1680" height="1050" />
     </state>
@@ -711,10 +702,10 @@
       <screen x="0" y="0" width="1680" height="1050" />
     </state>
     <state x="602" y="165" key="refactoring.ChangeSignatureDialog/0.0.1680.1050@0.0.1680.1050" timestamp="1588927230241" />
-    <state x="505" y="233" width="670" height="676" key="search.everywhere.popup" timestamp="1590028869053">
+    <state x="505" y="233" width="670" height="676" key="search.everywhere.popup" timestamp="1590076450707">
       <screen x="0" y="0" width="1680" height="1050" />
     </state>
-    <state x="505" y="233" width="670" height="676" key="search.everywhere.popup/0.0.1680.1050@0.0.1680.1050" timestamp="1590028869053" />
+    <state x="505" y="233" width="670" height="676" key="search.everywhere.popup/0.0.1680.1050@0.0.1680.1050" timestamp="1590076450707" />
     <state x="505" y="233" width="670" height="676" key="search.everywhere.popup/0.23.1680.980@0.23.1680.980" timestamp="1589689341400" />
   </component>
   <component name="XDebuggerManager">
Index: pay/urls.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from django.urls import path, re_path\nfrom .views import pay_test, pay_result\n\napp_name='pay'\nurlpatterns=[\n    path('pay_test/<int:arg1>/', pay_test, name='pay_test'),\n    path('pay_result/', pay_result, name='pay_result'),\n]
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pay/urls.py	(revision a6da3e3c2e50315842515be15c805f4b40a22181)
+++ pay/urls.py	(date 1590075452996)
@@ -3,6 +3,6 @@
 
 app_name='pay'
 urlpatterns=[
-    path('pay_test/<int:arg1>/', pay_test, name='pay_test'),
+    path('pay_test/<int:price>/<int:schedule_id>/', pay_test, name='pay_test'),
     path('pay_result/', pay_result, name='pay_result'),
 ]
\ No newline at end of file
